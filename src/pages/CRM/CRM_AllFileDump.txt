Folder and File Content Report
Root folder: D:\xbytechat\xbytechat-ui\src\pages\CRM
Generated at: 07-12-2025 18:10:05.18
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\MakeDump.bat 
====================================================== 
 
@echo off
REM This script will find relevant source files and output their names and contents into one file.
REM The output file will be named [FolderName]_AllFileDump.txt.

REM Get the current folder's name and set it as the output file name with the custom suffix
for %%I in ("%cd%") do set "outputFile=%%~nI_AllFileDump.txt"

REM Clear the output file to start fresh and write a small header
> "%outputFile%" (
    echo Folder and File Content Report
    echo Root folder: %cd%
    echo Generated at: %date% %time%
)
echo. >> "%outputFile%"

REM NOTE:
REM We now only dump RELEVANT text/code files (no binaries, no images, no node_modules, etc.)
REM This keeps the file smaller and much easier to review.

REM Loop through all relevant files in the current directory and subdirectories
REM Extensions included: C#, JS/TS/React, JSON, config, SQL, Markdown, YAML
for /R . %%F in (*.cs *.csproj *.jsx *.tsx *.js *.ts *.json *.config *.sql *.md *.yml *.yaml *.bat) do (

    REM Skip some noisy folders by path substring (node_modules, bin, obj, .git, dist, .vs)
    echo "%%F" | findstr /I /C:"\node_modules\" /C:"\bin\" /C:"\obj\" /C:"\.git\" /C:"\dist\" /C:"\.vs\" >nul
    if errorlevel 1 (
        echo ====================================================== >> "%outputFile%"
        echo FILE: %%F >> "%outputFile%"
        echo ====================================================== >> "%outputFile%"
        echo. >> "%outputFile%"
        type "%%F" >> "%outputFile%" 2>nul
        echo. >> "%outputFile%"
        echo. >> "%outputFile%"
    )
)

echo Finished! All content has been extracted to %outputFile%
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contact360\Contact360.jsx 
====================================================== 
 
// üìÑ File: src/pages/CRM/Contact360/Contact360.jsx

import React, { useEffect, useState, useMemo } from "react";
import { useParams, useNavigate } from "react-router-dom";
import axiosClient from "../../../api/axiosClient";
import { toast } from "react-toastify";
import {
  ArrowLeft,
  User,
  Phone,
  Mail,
  Tag,
  Bell,
  Activity,
  StickyNote,
  Clock,
} from "lucide-react";

function formatDateTime(value) {
  if (!value) return "-";
  try {
    return new Date(value).toLocaleString();
  } catch {
    return String(value);
  }
}

export default function Contact360() {
  const { contactId } = useParams();
  const navigate = useNavigate();

  const [summary, setSummary] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [loadError, setLoadError] = useState(null);

  useEffect(() => {
    if (!contactId) return;

    let cancelled = false;

    const load = async () => {
      try {
        setIsLoading(true);
        setLoadError(null);

        // üîó Same endpoint used by ChatInbox mini-panel
        const res = await axiosClient.get(`/crm/contact-summary/${contactId}`);
        const payload = res.data?.data ?? res.data;

        if (!cancelled) {
          setSummary(payload || null);
        }
      } catch (error) {
        console.error("‚ùå Failed to load contact 360 summary:", error);
        if (!cancelled) {
          setLoadError(
            error?.response?.data?.message ||
              "Failed to load contact 360 summary."
          );
          toast.error(
            error?.response?.data?.message ||
              "Failed to load contact 360 summary."
          );
        }
      } finally {
        if (!cancelled) {
          setIsLoading(false);
        }
      }
    };

    load();

    return () => {
      cancelled = true;
    };
  }, [contactId]);

  // Safe fallbacks for fields (because we don‚Äôt fully trust backend shape yet)
  const contactName =
    summary?.name ||
    summary?.fullName ||
    summary?.contactName ||
    summary?.basic?.name ||
    "Unknown contact";

  const contactPhone =
    summary?.phone ||
    summary?.phoneNumber ||
    summary?.contactPhone ||
    summary?.basic?.phone ||
    "-";

  const contactEmail =
    summary?.email || summary?.contactEmail || summary?.basic?.email || null;

  const company =
    summary?.company || summary?.companyName || summary?.basic?.company || null;

  const leadSource =
    summary?.leadSource ||
    summary?.source ||
    summary?.basic?.leadSource ||
    null;

  const tags =
    summary?.tags ??
    summary?.contactTags ??
    summary?.contactTagsDto ??
    summary?.basic?.tags ??
    [];

  const recentNotes = summary?.recentNotes ?? [];
  const nextReminder = summary?.nextReminder ?? null;
  const recentTimeline = summary?.recentTimeline ?? [];

  const stats = useMemo(() => {
    return {
      firstSeen: summary?.firstSeenAt || summary?.basic?.firstSeenAt || null,
      lastInbound:
        summary?.lastInboundAt || summary?.basic?.lastInboundAt || null,
      lastOutbound:
        summary?.lastOutboundAt || summary?.basic?.lastOutboundAt || null,
      totalMessages:
        summary?.totalMessages ?? summary?.metrics?.totalMessages ?? undefined,
      totalCampaigns:
        summary?.totalCampaigns ??
        summary?.metrics?.totalCampaigns ??
        undefined,
    };
  }, [summary]);

  return (
    <div className="h-full flex flex-col bg-slate-50">
      {/* Header bar */}
      <div className="h-[60px] border-b border-slate-200 bg-white flex items-center justify-between px-4">
        <div className="flex items-center gap-3">
          <button
            onClick={() => navigate(-1)}
            className="inline-flex items-center gap-1 text-xs text-slate-500 hover:text-slate-800"
          >
            <ArrowLeft className="w-4 h-4" />
            Back
          </button>

          <div className="flex items-center gap-3">
            <div className="w-9 h-9 rounded-full bg-emerald-100 flex items-center justify-center text-xs font-semibold text-emerald-700">
              {String(contactName).trim()[0]?.toUpperCase() ?? "?"}
            </div>
            <div>
              <div className="flex items-center gap-2">
                <span className="text-sm font-semibold text-slate-900">
                  {contactName}
                </span>
                {company && (
                  <span className="text-[11px] text-slate-500">
                    ‚Ä¢ {company}
                  </span>
                )}
              </div>
              <div className="flex flex-wrap items-center gap-2 text-[11px] text-slate-500 mt-0.5">
                <span className="inline-flex items-center gap-1">
                  <Phone className="w-3 h-3" />
                  {contactPhone}
                </span>
                {contactEmail && (
                  <span className="inline-flex items-center gap-1">
                    <Mail className="w-3 h-3" />
                    {contactEmail}
                  </span>
                )}
                {leadSource && (
                  <span className="inline-flex items-center gap-1">
                    <Clock className="w-3 h-3" />
                    Lead source: {leadSource}
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>

        <div className="text-[11px] text-slate-500">
          Contact 360 ‚Ä¢ CRM Workspace
        </div>
      </div>

      {/* Content */}
      <div className="flex-1 overflow-y-auto p-4">
        {isLoading && (
          <div className="h-full flex items-center justify-center text-xs text-slate-400">
            Loading contact 360‚Ä¶
          </div>
        )}

        {!isLoading && loadError && (
          <div className="max-w-xl mx-auto bg-rose-50 border border-rose-100 text-rose-700 text-xs rounded-lg p-3">
            {loadError}
          </div>
        )}

        {!isLoading && !loadError && (
          <div className="max-w-6xl mx-auto grid grid-cols-3 gap-4">
            {/* Left column: stats + tags */}
            <div className="col-span-1 space-y-3">
              {/* Stats */}
              <div className="bg-white rounded-xl border border-slate-200 p-3 shadow-sm">
                <div className="flex items-center gap-2 mb-2">
                  <User className="w-4 h-4 text-slate-500" />
                  <span className="text-xs font-semibold text-slate-800">
                    Interaction stats
                  </span>
                </div>

                <div className="grid grid-cols-2 gap-2 text-[11px]">
                  <div className="bg-slate-50 rounded-md p-2">
                    <div className="text-slate-400">First seen</div>
                    <div className="font-medium">
                      {formatDateTime(stats.firstSeen)}
                    </div>
                  </div>
                  <div className="bg-slate-50 rounded-md p-2">
                    <div className="text-slate-400">Last inbound</div>
                    <div className="font-medium">
                      {formatDateTime(stats.lastInbound)}
                    </div>
                  </div>
                  <div className="bg-slate-50 rounded-md p-2">
                    <div className="text-slate-400">Last outbound</div>
                    <div className="font-medium">
                      {formatDateTime(stats.lastOutbound)}
                    </div>
                  </div>
                  {typeof stats.totalMessages === "number" && (
                    <div className="bg-slate-50 rounded-md p-2">
                      <div className="text-slate-400">Total messages</div>
                      <div className="font-medium">{stats.totalMessages}</div>
                    </div>
                  )}
                </div>
              </div>

              {/* Tags */}
              <div className="bg-white rounded-xl border border-slate-200 p-3 shadow-sm">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <Tag className="w-4 h-4 text-slate-500" />
                    <span className="text-xs font-semibold text-slate-800">
                      Tags
                    </span>
                  </div>
                </div>
                <div className="flex flex-wrap gap-1.5">
                  {tags && tags.length > 0 ? (
                    tags.map((t, index) => (
                      <span
                        key={t.id || t.tagId || index}
                        className="px-2 py-0.5 text-[10px] rounded-full font-medium border border-slate-200"
                        style={{
                          backgroundColor: t.colorHex || "#EEF2FF",
                        }}
                      >
                        {t.tagName || t.name || "Tag"}
                      </span>
                    ))
                  ) : (
                    <span className="text-[11px] text-slate-400">
                      No tags yet. Use CRM &gt; Tags to segment this contact.
                    </span>
                  )}
                </div>
              </div>

              {/* Next reminder */}
              <div className="bg-white rounded-xl border border-slate-200 p-3 shadow-sm">
                <div className="flex items-center gap-2 mb-2">
                  <Bell className="w-4 h-4 text-slate-500" />
                  <span className="text-xs font-semibold text-slate-800">
                    Next reminder
                  </span>
                </div>
                {nextReminder ? (
                  <div className="bg-amber-50 border border-amber-100 rounded-md p-2 text-[11px] text-amber-900">
                    <div className="flex items-center justify-between gap-2">
                      <span className="font-semibold">
                        {nextReminder.title}
                      </span>
                      <span className="text-[10px]">
                        {formatDateTime(nextReminder.dueAt)}
                      </span>
                    </div>
                    {nextReminder.description && (
                      <div className="mt-0.5">{nextReminder.description}</div>
                    )}
                    {nextReminder.status && (
                      <div className="mt-0.5 text-[10px]">
                        Status: {nextReminder.status}
                      </div>
                    )}
                  </div>
                ) : (
                  <span className="text-[11px] text-slate-400">
                    No upcoming reminder. Use CRM &gt; Reminders to schedule a
                    follow-up.
                  </span>
                )}
              </div>
            </div>

            {/* Right columns: notes + timeline */}
            <div className="col-span-2 space-y-3">
              {/* Recent notes */}
              <div className="bg-white rounded-xl border border-slate-200 p-3 shadow-sm">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <StickyNote className="w-4 h-4 text-slate-500" />
                    <span className="text-xs font-semibold text-slate-800">
                      Recent notes
                    </span>
                  </div>
                </div>
                {recentNotes && recentNotes.length > 0 ? (
                  <div className="space-y-1.5">
                    {recentNotes.map(note => (
                      <div
                        key={note.id}
                        className="bg-slate-50 border border-slate-100 rounded-md p-2 text-[11px]"
                      >
                        <div className="text-slate-800">
                          {note.content || note.text || "(no content)"}
                        </div>
                        <div className="mt-0.5 text-[10px] text-slate-400 flex justify-between">
                          <span>
                            {note.createdByName || note.createdBy || "Agent"}
                          </span>
                          <span>
                            {note.createdAt
                              ? new Date(note.createdAt).toLocaleString()
                              : ""}
                          </span>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="text-[11px] text-slate-400">
                    No notes yet. Use CRM &gt; Notes to document this lead‚Äôs
                    context.
                  </div>
                )}
              </div>

              {/* Timeline */}
              <div className="bg-white rounded-xl border border-slate-200 p-3 shadow-sm">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <Activity className="w-4 h-4 text-slate-500" />
                    <span className="text-xs font-semibold text-slate-800">
                      Recent activity
                    </span>
                  </div>
                </div>
                {recentTimeline && recentTimeline.length > 0 ? (
                  <div className="space-y-1.5 text-[11px]">
                    {recentTimeline.map(event => (
                      <div key={event.id} className="flex gap-2 items-start">
                        <div className="mt-1 w-1 h-1 rounded-full bg-slate-400" />
                        <div className="flex-1">
                          <div className="text-slate-800">
                            {event.title ||
                              event.shortDescription ||
                              event.description ||
                              "Activity"}
                          </div>
                          <div className="mt-0.5 text-[10px] text-slate-400 flex justify-between">
                            <span>
                              {event.source ||
                                event.category ||
                                event.eventType ||
                                ""}
                            </span>
                            <span>
                              {event.createdAt
                                ? new Date(event.createdAt).toLocaleString()
                                : ""}
                            </span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="text-[11px] text-slate-400">
                    No timeline entries yet. Your future CTA flows, campaigns
                    and reminders will populate this stream.
                  </div>
                )}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\ContactForm.jsx 
====================================================== 
 
import React, { useEffect, useState } from "react";
import axiosClient from "../../../api/axiosClient";
import { toast } from "react-toastify";

function ContactForm({ contact, onSaveComplete }) {
  const [formData, setFormData] = useState({
    name: "",
    phoneNumber: "",
    email: "",
    leadSource: "",
    notes: "",
    tags: [], // Array of tag IDs
    // Date fields are handled separately to avoid timezone issues
  });
  const [allTags, setAllTags] = useState([]);
  const [saving, setSaving] = useState(false);

  // Fetch all available tags when the component mounts
  useEffect(() => {
    const fetchTags = async () => {
      try {
        const response = await axiosClient.get("/tags");
        setAllTags(response.data.data || response.data); // Handle wrapper if it exists
      } catch (error) {
        console.error("Failed to load tags:", error);
        toast.error("‚ùå Failed to load tags");
      }
    };
    fetchTags();
  }, []);

  // Populate the form when an existing contact is passed in
  useEffect(() => {
    if (contact) {
      setFormData({
        name: contact.name || "",
        phoneNumber: contact.phoneNumber || "",
        email: contact.email || "",
        leadSource: contact.leadSource || "",
        notes: contact.notes || "",
        tags: contact.tags?.map(t => t.tagId) || [],
      });
    }
  }, [contact]);

  const handleChange = e => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleTagChange = e => {
    const selected = Array.from(e.target.selectedOptions, opt => opt.value);
    setFormData(prev => ({ ...prev, tags: selected }));
  };

  const handleSubmit = async e => {
    e.preventDefault();
    setSaving(true);

    // Backend expects an array of Guids/strings for the tag IDs
    const payload = {
      ...formData,
      tagIds: formData.tags, // Send just the array of IDs
    };

    try {
      if (contact?.id) {
        // Update existing contact
        await axiosClient.put(`/contacts/${contact.id}`, payload);
        toast.success("‚úÖ Contact updated successfully!");
      } else {
        // Create new contact
        await axiosClient.post("/contacts", payload);
        toast.success("‚úÖ Contact created successfully!");
      }
      onSaveComplete?.(); // Notify parent component to refresh/close
    } catch (err) {
      // Display the specific error message from the backend
      const errorMessage =
        err.response?.data?.message || "‚ùå Failed to save contact.";
      toast.error(errorMessage);
      console.error("Save contact failed:", err);
    } finally {
      setSaving(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <input
        name="name"
        value={formData.name}
        onChange={handleChange}
        required
        placeholder="Name"
        className="w-full border px-3 py-2 rounded-md"
      />
      <input
        name="phoneNumber"
        value={formData.phoneNumber}
        onChange={handleChange}
        placeholder="Phone Number"
        className="w-full border px-3 py-2 rounded-md"
      />
      <input
        type="email"
        name="email"
        value={formData.email}
        onChange={handleChange}
        placeholder="Email"
        className="w-full border px-3 py-2 rounded-md"
      />

      <div>
        <label className="text-sm text-gray-600">Tags</label>
        <select
          multiple
          value={formData.tags}
          onChange={handleTagChange}
          className="w-full border px-3 py-2 rounded-md h-24"
        >
          {allTags.map(tag => (
            <option key={tag.id} value={tag.id}>
              {tag.name}
            </option>
          ))}
        </select>
      </div>

      <textarea
        name="notes"
        value={formData.notes}
        onChange={handleChange}
        placeholder="Notes..."
        className="w-full border px-3 py-2 rounded-md"
        rows={3}
      />

      <button
        type="submit"
        disabled={saving}
        className="w-full bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 disabled:bg-purple-300"
      >
        {saving ? "Saving..." : contact?.id ? "Update Contact" : "Add Contact"}
      </button>
    </form>
  );
}

export default ContactForm;

// import React, { useEffect, useState } from "react";
// import axios from "axios";
// import { toast } from "react-toastify";

// function ContactForm({ contact, onSaveComplete }) {
//   const [formData, setFormData] = useState({
//     name: "",
//     phoneNumber: "",
//     email: "",
//     leadSource: "",
//     notes: "",
//     lastContactedAt: "",
//     nextFollowUpAt: "",
//     tags: [], // Now array of tag IDs
//   });

//   const [allTags, setAllTags] = useState([]);

//   useEffect(() => {
//     // Load all tags from DB
//     axios
//       .get("/api/tags")
//       .then(res => setAllTags(res.data))
//       .catch(() => toast.error("‚ùå Failed to load tags"));
//   }, []);

//   useEffect(() => {
//     if (contact) {
//       setFormData({
//         name: contact.name || "",
//         phoneNumber: contact.phoneNumber || "",
//         email: contact.email || "",
//         leadSource: contact.leadSource || "",
//         notes: contact.notes || "",
//         lastContactedAt: contact.lastContactedAt || "",
//         nextFollowUpAt: contact.nextFollowUpAt || "",
//         tags: contact.tags?.map(t => t.tagId) || [],
//       });
//     }
//   }, [contact]);

//   const handleChange = e => {
//     const { name, value } = e.target;
//     setFormData(prev => ({ ...prev, [name]: value }));
//   };

//   const handleTagChange = e => {
//     const selected = Array.from(e.target.selectedOptions, opt => opt.value);
//     setFormData(prev => ({ ...prev, tags: selected }));
//   };

//   const handleSubmit = async e => {
//     e.preventDefault();

//     const mappedTags = formData.tags.map(id => {
//       const tag = allTags.find(t => t.id === id);
//       return { tagId: tag.id, tagName: tag.name };
//     });

//     const payload = {
//       ...formData,
//       tags: mappedTags,
//     };

//     try {
//       if (contact?.id) {
//         await axios.put(`/contacts/${contact.id}`, payload);
//         toast.success("‚úÖ Contact updated");
//       } else {
//         await axios.post("/contacts", payload);
//         toast.success("‚úÖ Contact added");
//       }

//       onSaveComplete?.();
//     } catch (err) {
//       console.error(err);
//       toast.error("‚ùå Failed to save contact");
//     }
//   };

//   return (
//     <form onSubmit={handleSubmit} className="space-y-3">
//       <input
//         name="name"
//         value={formData.name}
//         onChange={handleChange}
//         required
//         placeholder="Name"
//         className="w-full border px-3 py-2 rounded"
//       />
//       <input
//         name="phoneNumber"
//         value={formData.phoneNumber}
//         onChange={handleChange}
//         required
//         placeholder="Phone"
//         className="w-full border px-3 py-2 rounded"
//       />
//       <input
//         name="email"
//         value={formData.email}
//         onChange={handleChange}
//         placeholder="Email"
//         className="w-full border px-3 py-2 rounded"
//       />
//       <input
//         name="leadSource"
//         value={formData.leadSource}
//         onChange={handleChange}
//         placeholder="Lead Source"
//         className="w-full border px-3 py-2 rounded"
//       />

//       {/* ‚úÖ Tag Select */}
//       <select
//         multiple
//         value={formData.tags}
//         onChange={handleTagChange}
//         className="w-full border px-3 py-2 rounded"
//       >
//         {allTags.map(tag => (
//           <option key={tag.id} value={tag.id}>
//             {tag.name}
//           </option>
//         ))}
//       </select>

//       <input
//         type="datetime-local"
//         name="lastContactedAt"
//         value={formData.lastContactedAt}
//         onChange={handleChange}
//         className="w-full border px-3 py-2 rounded"
//       />
//       <input
//         type="datetime-local"
//         name="nextFollowUpAt"
//         value={formData.nextFollowUpAt}
//         onChange={handleChange}
//         className="w-full border px-3 py-2 rounded"
//       />
//       <textarea
//         name="notes"
//         value={formData.notes}
//         onChange={handleChange}
//         placeholder="Notes"
//         className="w-full border px-3 py-2 rounded"
//       />

//       <button
//         type="submit"
//         className="bg-purple-600 text-white px-4 py-2 rounded"
//       >
//         {contact?.id ? "Update Contact" : "Add Contact"}
//       </button>
//     </form>
//   );
// }

// export default ContactForm;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\ContactList.jsx 
====================================================== 
 
import React from "react";
import { FaEllipsisV } from "react-icons/fa";

function getInitials(name) {
  if (!name) return "";
  const parts = name.trim().split(" ");
  return parts
    .slice(0, 2)
    .map(word => word[0])
    .join("")
    .toUpperCase();
}

export default function ContactList({
  contacts,
  onEdit,
  onDelete,
  onNotes,
  onTimeline,
}) {
  return (
    <div className="overflow-x-auto mt-4 rounded-xl border shadow-sm">
      <table className="min-w-full bg-white">
        <thead className="text-left bg-gray-100 text-sm font-medium">
          <tr>
            <th className="px-4 py-3">Name</th>
            <th className="px-4 py-3">Phone</th>
            <th className="px-4 py-3">Tags</th>
            <th className="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody className="text-sm">
          {contacts.map(contact => (
            <tr key={contact.id} className="border-t hover:bg-gray-50">
              <td className="px-4 py-3 flex items-center gap-3">
                <div className="w-9 h-9 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center font-bold text-sm shadow-sm">
                  {getInitials(contact.name)}
                </div>
                <span className="font-semibold">{contact.name}</span>
              </td>

              <td className="px-4 py-3 text-gray-700">
                {contact.phoneNumber || (
                  <span className="text-gray-400 italic">No number</span>
                )}
              </td>

              <td className="px-4 py-3">
                <div className="flex flex-wrap gap-1">
                  {(contact.tags ?? contact.contactTags ?? []).length > 0 ? (
                    (contact.tags ?? contact.contactTags).map((tag, index) => (
                      <span
                        key={index}
                        className="px-2 py-0.5 text-xs rounded-full font-medium"
                        style={{
                          backgroundColor: tag.colorHex || "#EEE",
                          color: "#1F2937",
                        }}
                      >
                        {tag.tagName || tag.name}
                      </span>
                    ))
                  ) : (
                    <span className="text-gray-400 text-xs italic">
                      No tags
                    </span>
                  )}
                </div>
              </td>

              <td className="px-4 py-3 text-right relative">
                <DropdownMenu
                  onEdit={() => onEdit(contact)}
                  onDelete={() => onDelete(contact)}
                  onNotes={() => onNotes(contact)}
                  onTimeline={() => onTimeline(contact)}
                />
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

function DropdownMenu({ onEdit, onDelete, onNotes, onTimeline }) {
  const [open, setOpen] = React.useState(false);

  return (
    <div className="relative inline-block text-left">
      <button
        onClick={() => setOpen(prev => !prev)}
        className="p-2 rounded-full hover:bg-gray-100"
      >
        <FaEllipsisV size={14} />
      </button>

      {open && (
        <div className="absolute right-0 z-10 mt-2 w-40 origin-top-right rounded-md bg-white shadow-lg border">
          <div className="py-1 text-sm text-gray-700">
            <button
              onClick={onEdit}
              className="block w-full px-4 py-2 hover:bg-gray-100 text-left"
            >
              ‚úèÔ∏è Edit
            </button>
            <button
              onClick={onNotes}
              className="block w-full px-4 py-2 hover:bg-gray-100 text-left"
            >
              üìù Notes
            </button>
            <button
              onClick={onTimeline}
              className="block w-full px-4 py-2 hover:bg-gray-100 text-left"
            >
              üïí Timeline
            </button>
            <button
              onClick={onDelete}
              className="block w-full px-4 py-2 text-red-600 hover:bg-red-50 text-left"
            >
              üóë Delete
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\Contacts.jsx 
====================================================== 
 
// üìÑ src/pages/CRM/Contacts/Contacts.jsx

import React, { useEffect, useMemo, useState } from "react";
import { useLocation } from "react-router-dom";
import {
  User,
  Tag,
  Clock,
  StickyNote,
  Bell,
  Activity,
  Filter,
} from "lucide-react";
import { toast } from "react-toastify";

import axiosClient from "../../../api/axiosClient";

import ContactsTopBar from "./components/ContactsTopBar";
import ContactsTable from "./components/ContactsTable";
import ContactFormModal from "./components/ContactFormModal";
import BulkActionsBar from "./components/BulkActionsBar";

function formatDateTime(value) {
  if (!value) return "‚Äî";
  try {
    return new Date(value).toLocaleString();
  } catch {
    return String(value);
  }
}

export default function Contacts() {
  // üîπ UI state for list side
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingContact, setEditingContact] = useState(null);
  const [refreshTrigger, setRefreshTrigger] = useState(0);
  const [activeTab, setActiveTab] = useState("all");
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedIds, setSelectedIds] = useState([]);
  const [currentPage, setCurrentPage] = useState(1);

  // üîπ URL -> contactId (for when we deep-link from Chat Inbox)
  const location = useLocation();
  const [focusedContactId, setFocusedContactId] = useState(null);

  // üîπ Contact 360 summary data
  const [contactSummary, setContactSummary] = useState(null);
  const [isSummaryLoading, setIsSummaryLoading] = useState(false);

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 1) Hydrate focusedContactId from URL (?contactId=...)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const idFromUrl = params.get("contactId");

    if (idFromUrl) {
      setFocusedContactId(idFromUrl);

      // Keep selection in a reasonable state for BulkActionsBar
      setSelectedIds(prev =>
        prev && prev.length > 0 && prev.includes(idFromUrl) ? prev : [idFromUrl]
      );
    }
  }, [location.search]);

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 2) When user selects contacts via checkboxes,
  //    focus the first one for Contact 360
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  useEffect(() => {
    if (selectedIds && selectedIds.length > 0) {
      setFocusedContactId(selectedIds[0]);
    } else {
      // Only clear if not coming from a URL-driven focus
      const params = new URLSearchParams(location.search);
      const idFromUrl = params.get("contactId");
      if (!idFromUrl) {
        setFocusedContactId(null);
        setContactSummary(null);
      }
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [selectedIds]);

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 3) Handlers for list side
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const handleAddClick = () => {
    setEditingContact(null);
    setIsModalOpen(true);
  };

  const handleEditContact = contact => {
    setEditingContact(contact);
    setIsModalOpen(true);
  };

  const handleModalClose = () => {
    setIsModalOpen(false);
    setEditingContact(null);
  };

  const handleSaveComplete = () => {
    // Modal will close itself via onClose; we just trigger refresh.
    setRefreshTrigger(prev => prev + 1);
  };

  const handleSelectionChange = ids => {
    setSelectedIds(ids || []);
  };

  const handleTabChange = tab => {
    setActiveTab(tab);
    setCurrentPage(1);
    setSelectedIds([]);
  };

  const handleClearSelection = () => {
    setSelectedIds([]);
  };

  const handleRefreshList = () => {
    setRefreshTrigger(prev => prev + 1);
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 4) Fetch Contact 360 summary when focusedContactId changes
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  useEffect(() => {
    const contactId = focusedContactId;
    if (!contactId) return;

    let cancelled = false;

    const loadSummary = async () => {
      try {
        setIsSummaryLoading(true);
        const response = await axiosClient.get(
          `/crm/contact-summary/${contactId}`
        );
        if (cancelled) return;
        setContactSummary(response.data || null);
      } catch (error) {
        if (cancelled) return;
        console.error("Failed to load contact summary", error);
        toast.error(
          error?.response?.data?.message ||
            "Failed to load Contact 360 summary."
        );
        setContactSummary(null);
      } finally {
        if (!cancelled) {
          setIsSummaryLoading(false);
        }
      }
    };

    loadSummary();

    return () => {
      cancelled = true;
    };
  }, [focusedContactId]);

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 5) Derived CRM summary slices (tags, notes, reminder, timeline)
  //    ‚Äì mirrors the logic we‚Äôre already using in Chat Inbox
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const tagsList = useMemo(() => {
    if (!contactSummary) return [];
    if (Array.isArray(contactSummary.tags)) return contactSummary.tags;
    if (Array.isArray(contactSummary.contactTags))
      return contactSummary.contactTags;
    if (Array.isArray(contactSummary.tagSummaries))
      return contactSummary.tagSummaries;
    if (Array.isArray(contactSummary.tagList)) return contactSummary.tagList;
    return [];
  }, [contactSummary]);

  const recentNotes = useMemo(() => {
    if (!contactSummary) return [];
    const notes =
      contactSummary.recentNotes ||
      contactSummary.notes ||
      contactSummary.lastNotes ||
      [];
    return Array.isArray(notes) ? notes.slice(0, 3) : [];
  }, [contactSummary]);

  const nextReminder = useMemo(() => {
    if (!contactSummary) return null;
    return (
      contactSummary.nextReminder ||
      contactSummary.upcomingReminder ||
      contactSummary.reminder ||
      null
    );
  }, [contactSummary]);

  const recentTimeline = useMemo(() => {
    if (!contactSummary) return [];
    const items =
      contactSummary.recentTimeline ||
      contactSummary.timeline ||
      contactSummary.events ||
      [];
    return Array.isArray(items) ? items.slice(0, 5) : [];
  }, [contactSummary]);

  const basic =
    contactSummary?.contact ||
    contactSummary?.contactBasic ||
    contactSummary?.contactInfo ||
    contactSummary ||
    null;

  const displayName =
    basic?.fullName || basic?.name || basic?.contactName || "‚Äî";
  const displayPhone =
    basic?.phoneNumber || basic?.whatsappNumber || basic?.phone || "";
  const displayEmail = basic?.email || basic?.emailAddress || "";
  const displayStatus =
    basic?.status || basic?.lifecycleStage || basic?.stage || null;
  const createdAt =
    basic?.createdAt ||
    basic?.createdOn ||
    basic?.firstSeenAt ||
    basic?.createdDate;
  const lastInbound =
    basic?.lastInboundAt ||
    basic?.lastInboundMessageAt ||
    basic?.lastIncomingAt;
  const lastOutbound =
    basic?.lastOutboundAt ||
    basic?.lastOutboundMessageAt ||
    basic?.lastOutgoingAt;

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // 6) Render
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  return (
    <div className="flex h-full bg-slate-50">
      {/* LEFT: Contacts list + filters + bulk actions */}
      <div className="flex-1 flex flex-col border-r border-slate-200 bg-white">
        {/* Top bar: search + tabs + filters */}
        <div className="border-b border-slate-200">
          <ContactsTopBar
            onAddClick={handleAddClick}
            onSearchChange={setSearchTerm}
            activeTab={activeTab}
            onTabChange={handleTabChange}
            searchTerm={searchTerm}
            onFilterClick={() =>
              toast.info("Advanced filters will come in a later phase.")
            }
          />
        </div>

        {/* Bulk actions (only visible when something is selected) */}
        {selectedIds.length > 0 && (
          <BulkActionsBar
            selectedIds={selectedIds}
            onClearSelection={handleClearSelection}
            onRefresh={handleRefreshList}
          />
        )}

        {/* Contacts table */}
        <div className="flex-1 overflow-hidden">
          <ContactsTable
            onEdit={handleEditContact}
            refreshTrigger={refreshTrigger}
            activeTab={activeTab}
            onSelectionChange={handleSelectionChange}
            searchTerm={searchTerm}
            currentPage={currentPage}
            setCurrentPage={setCurrentPage}
          />
        </div>

        {/* Contact create/edit modal */}
        <ContactFormModal
          isOpen={isModalOpen}
          onClose={handleModalClose}
          contact={editingContact}
          onSaveComplete={handleSaveComplete}
        />
      </div>

      {/* RIGHT: Contact 360 mini-CRM panel */}
      <div className="hidden lg:flex w-[360px] xl:w-[380px] flex-col bg-slate-25">
        {/* Header */}
        <div className="border-b border-slate-200 px-4 py-3 bg-white">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-[11px] font-semibold uppercase tracking-wide text-slate-500">
                Contact 360
              </p>
              <p className="text-xs text-slate-500">
                Quick CRM snapshot for the selected contact
              </p>
            </div>
            <div className="h-8 w-8 rounded-full bg-purple-50 flex items-center justify-center">
              <User className="h-4 w-4 text-purple-600" />
            </div>
          </div>
        </div>

        {/* Body */}
        <div className="flex-1 overflow-y-auto px-4 py-3 space-y-4">
          {/* Empty state */}
          {!focusedContactId && !isSummaryLoading && (
            <div className="mt-8 text-center text-slate-500 text-sm">
              <div className="mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-full bg-slate-100">
                <Filter className="h-4 w-4 text-slate-500" />
              </div>
              <p className="font-medium">No contact selected</p>
              <p className="mt-1 text-xs text-slate-500">
                Select a contact from the list (or open this page from Chat
                Inbox) to see their CRM profile.
              </p>
            </div>
          )}

          {/* Loading */}
          {focusedContactId && isSummaryLoading && (
            <div className="mt-6 space-y-3">
              <div className="animate-pulse space-y-3">
                <div className="h-5 w-32 rounded bg-slate-200" />
                <div className="h-16 rounded-xl bg-slate-100" />
                <div className="h-10 rounded-xl bg-slate-100" />
                <div className="h-24 rounded-xl bg-slate-100" />
              </div>
            </div>
          )}

          {/* Actual summary */}
          {focusedContactId && !isSummaryLoading && contactSummary && (
            <>
              {/* Basic info card */}
              <div className="rounded-xl border border-slate-200 bg-slate-50 px-3 py-3">
                <div className="flex items-start justify-between gap-2">
                  <div>
                    <div className="text-sm font-semibold text-slate-900">
                      {displayName}
                    </div>
                    {displayPhone && (
                      <div className="mt-0.5 text-xs text-slate-600 font-mono">
                        {displayPhone}
                      </div>
                    )}
                    {displayEmail && (
                      <div className="mt-0.5 text-xs text-slate-500">
                        {displayEmail}
                      </div>
                    )}
                  </div>
                  {displayStatus && (
                    <span className="inline-flex items-center rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 text-[10px] font-medium text-amber-700">
                      {displayStatus}
                    </span>
                  )}
                </div>

                <div className="mt-3 grid grid-cols-2 gap-3 text-[11px] text-slate-600">
                  <div>
                    <p className="text-[10px] uppercase text-slate-400">
                      Created
                    </p>
                    <p className="mt-0.5 font-medium">
                      {formatDateTime(createdAt)}
                    </p>
                  </div>
                  <div>
                    <p className="text-[10px] uppercase text-slate-400">
                      Last inbound
                    </p>
                    <p className="mt-0.5 font-medium">
                      {formatDateTime(lastInbound)}
                    </p>
                  </div>
                  <div>
                    <p className="text-[10px] uppercase text-slate-400">
                      Last outbound
                    </p>
                    <p className="mt-0.5 font-medium">
                      {formatDateTime(lastOutbound)}
                    </p>
                  </div>
                </div>
              </div>

              {/* Tags */}
              <div className="rounded-xl border border-slate-200 bg-white px-3 py-3">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <div className="h-6 w-6 rounded-full bg-purple-50 flex items-center justify-center">
                      <Tag className="h-3 w-3 text-purple-600" />
                    </div>
                    <p className="text-xs font-semibold text-slate-800">Tags</p>
                  </div>
                </div>
                {tagsList.length === 0 ? (
                  <p className="text-xs text-slate-500">
                    No tags yet. You can tag this contact from the main Contacts
                    view.
                  </p>
                ) : (
                  <div className="flex flex-wrap gap-1.5">
                    {tagsList.map(tag => (
                      <span
                        key={tag.id || tag.tagId || tag.name}
                        className="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] text-slate-800"
                      >
                        {tag.color && (
                          <span
                            className="mr-1 h-2 w-2 rounded-full"
                            style={{ backgroundColor: tag.color }}
                          />
                        )}
                        {tag.name || tag.label || tag.tagName}
                      </span>
                    ))}
                  </div>
                )}
              </div>

              {/* Next Reminder */}
              <div className="rounded-xl border border-slate-200 bg-white px-3 py-3">
                <div className="flex items-center gap-2 mb-2">
                  <div className="h-6 w-6 rounded-full bg-emerald-50 flex items-center justify-center">
                    <Bell className="h-3 w-3 text-emerald-700" />
                  </div>
                  <p className="text-xs font-semibold text-slate-800">
                    Next reminder
                  </p>
                </div>
                {!nextReminder ? (
                  <p className="text-xs text-slate-500">
                    No upcoming reminder scheduled.
                  </p>
                ) : (
                  <div className="space-y-1 text-xs text-slate-700">
                    <p className="font-medium">
                      {nextReminder.title || nextReminder.subject || "Reminder"}
                    </p>
                    {nextReminder.dueAt && (
                      <p className="flex items-center gap-1 text-slate-500">
                        <Clock className="h-3 w-3" />
                        {formatDateTime(
                          nextReminder.dueAt ||
                            nextReminder.dueDate ||
                            nextReminder.remindAt
                        )}
                      </p>
                    )}
                    {nextReminder.note && (
                      <p className="text-[11px] text-slate-500">
                        {nextReminder.note}
                      </p>
                    )}
                  </div>
                )}
              </div>

              {/* Recent Notes */}
              <div className="rounded-xl border border-slate-200 bg-white px-3 py-3">
                <div className="flex items-center gap-2 mb-2">
                  <div className="h-6 w-6 rounded-full bg-sky-50 flex items-center justify-center">
                    <StickyNote className="h-3 w-3 text-sky-700" />
                  </div>
                  <p className="text-xs font-semibold text-slate-800">
                    Recent notes
                  </p>
                </div>
                {recentNotes.length === 0 ? (
                  <p className="text-xs text-slate-500">
                    No notes yet. Use the Notes module in CRM to add context for
                    this lead.
                  </p>
                ) : (
                  <div className="space-y-2">
                    {recentNotes.map(note => (
                      <div
                        key={note.id || note.noteId}
                        className="rounded-lg border border-slate-100 bg-slate-50 px-2 py-1.5"
                      >
                        <p className="text-[11px] font-medium text-slate-800">
                          {note.title || "Note"}
                        </p>
                        {note.content && (
                          <p className="mt-0.5 text-[11px] text-slate-600 line-clamp-2">
                            {note.content}
                          </p>
                        )}
                        {note.createdAt && (
                          <p className="mt-0.5 text-[10px] text-slate-400">
                            {formatDateTime(note.createdAt)}
                          </p>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {/* Recent Timeline */}
              <div className="rounded-xl border border-slate-200 bg-white px-3 py-3 mb-2">
                <div className="flex items-center gap-2 mb-2">
                  <div className="h-6 w-6 rounded-full bg-indigo-50 flex items-center justify-center">
                    <Activity className="h-3 w-3 text-indigo-700" />
                  </div>
                  <p className="text-xs font-semibold text-slate-800">
                    Recent activity
                  </p>
                </div>
                {recentTimeline.length === 0 ? (
                  <p className="text-xs text-slate-500">
                    No recent timeline events captured for this contact yet.
                  </p>
                ) : (
                  <ol className="space-y-1.5 text-[11px] text-slate-700">
                    {recentTimeline.map(item => (
                      <li
                        key={item.id || item.eventId || item.occurredAt}
                        className="flex items-start gap-2"
                      >
                        <span className="mt-1 h-1.5 w-1.5 rounded-full bg-indigo-500 flex-shrink-0" />
                        <div>
                          <p className="font-medium">
                            {item.title || item.type || "Event"}
                          </p>
                          {item.description && (
                            <p className="text-[11px] text-slate-600 line-clamp-2">
                              {item.description}
                            </p>
                          )}
                          {item.occurredAt && (
                            <p className="text-[10px] text-slate-400 mt-0.5">
                              {formatDateTime(item.occurredAt)}
                            </p>
                          )}
                        </div>
                      </li>
                    ))}
                  </ol>
                )}
              </div>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

// import React, { useState } from "react";
// import TopBar from "./components/ContactsTopBar";
// import ContactsTable from "./components/ContactsTable";
// import ContactFormModal from "./components/ContactFormModal";
// import BulkActionsBar from "./components/BulkActionsBar";

// function Contacts() {
//   const [isModalOpen, setIsModalOpen] = useState(false);
//   const [selectedContact, setSelectedContact] = useState(null);
//   const [refreshTrigger, setRefreshTrigger] = useState(0);
//   const [currentPage, setCurrentPage] = useState(1); // ‚úÖ Added here
//   const [activeTab, setActiveTab] = useState("all");
//   const [searchTerm, setSearchTerm] = useState("");
//   const [selectedIds, setSelectedIds] = useState([]);

//   const handleAddNew = () => {
//     setSelectedContact(null);
//     setIsModalOpen(true);
//   };

//   const handleEdit = contact => {
//     setSelectedContact(contact);
//     setIsModalOpen(true);
//   };

//   const handleSaveComplete = () => {
//     setIsModalOpen(false);
//     setSelectedContact(null);
//     setCurrentPage(1); // ‚úÖ Reset to page 1 on save
//     setRefreshTrigger(prev => prev + 1);
//   };

//   const handleSelectionChange = ids => {
//     setSelectedIds(ids);
//   };

//   const clearSelection = () => {
//     setSelectedIds([]);
//   };

//   return (
//     <div className="p-4 space-y-4">
//       <TopBar
//         onAddClick={handleAddNew}
//         activeTab={activeTab}
//         onTabChange={setActiveTab}
//         onSearchChange={setSearchTerm}
//       />

//       {selectedIds.length > 0 && (
//         <BulkActionsBar
//           selectedIds={selectedIds}
//           onClearSelection={clearSelection}
//           onRefresh={() => setRefreshTrigger(prev => prev + 1)}
//         />
//       )}

//       <ContactsTable
//         onEdit={handleEdit}
//         activeTab={activeTab}
//         refreshTrigger={refreshTrigger}
//         searchTerm={searchTerm}
//         onSelectionChange={handleSelectionChange}
//         selectedIds={selectedIds}
//         currentPage={currentPage}
//         setCurrentPage={setCurrentPage} // ‚úÖ Pass down
//       />

//       <ContactFormModal
//         isOpen={isModalOpen}
//         onClose={() => setIsModalOpen(false)}
//         contact={selectedContact}
//         onSaveComplete={handleSaveComplete}
//       />
//     </div>
//   );
// }

// export default Contacts;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\ContactsTopBar.jsx 
====================================================== 
 
// üìÑ File: src/pages/Contacts/ContactsTopBar.jsx

import { useState } from "react";
import { Search, Filter, Plus } from "lucide-react";

const tabs = [
  { id: "all", label: "All Contacts", count: 266 },
  { id: "favourites", label: "Favourites", count: 86 },
  { id: "groups", label: "Groups", count: 23 },
  { id: "archived", label: "Archived", count: 8 },
];

export default function ContactsTopBar({ onAdd }) {
  const [activeTab, setActiveTab] = useState("all");
  const [search, setSearch] = useState("");

  return (
    <div className="flex flex-col gap-4 mb-6">
      {/* üîç Search + Actions */}
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
        <div className="flex items-center w-full md:max-w-sm bg-white border border-gray-300 rounded-lg px-3 py-2 shadow-sm">
          <Search size={18} className="text-gray-400 mr-2" />
          <input
            type="text"
            placeholder="Search contact, group or project"
            value={search}
            onChange={e => setSearch(e.target.value)}
            className="w-full outline-none text-sm text-gray-700"
          />
        </div>

        <div className="flex items-center gap-2 mt-2 md:mt-0">
          <button className="text-sm text-gray-600 hover:text-purple-700 flex items-center gap-1 border px-3 py-2 rounded-md border-gray-300">
            <Filter size={16} />
            <span className="hidden sm:inline">Filter</span>
          </button>
          <button
            onClick={onAdd}
            className="bg-purple-600 hover:bg-purple-700 text-white text-sm px-4 py-2 rounded-md flex items-center gap-2 shadow"
          >
            <Plus size={16} />
            Add Contact
          </button>
        </div>
      </div>

      {/* üìÅ Tabs */}
      <div className="flex items-center gap-6 border-b border-gray-200 text-sm font-medium">
        {tabs.map(tab => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id)}
            className={`pb-2 border-b-2 ${
              activeTab === tab.id
                ? "border-purple-600 text-purple-700"
                : "border-transparent text-gray-500 hover:text-purple-600"
            }`}
          >
            {tab.label}{" "}
            <span className="text-xs text-gray-400 ml-1">({tab.count})</span>
          </button>
        ))}
      </div>
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\CsvUploadModal.jsx 
====================================================== 
 
import React, { useState } from "react";
import { toast } from "react-toastify";
import axios from "axios";

// Props: isOpen (bool), onClose (fn), onUploadComplete (contacts, skipSaving)
export default function CsvUploadModal({ isOpen, onClose, onUploadComplete }) {
  const [file, setFile] = useState(null);
  const [skipSaving, setSkipSaving] = useState(false);
  const [uploading, setUploading] = useState(false);

  const handleFileChange = e => {
    setFile(e.target.files[0]);
  };

  const handleUpload = async () => {
    if (!file) {
      toast.warn("‚ö†Ô∏è Please select a CSV file.");
      return;
    }

    const formData = new FormData();
    formData.append("file", file);

    setUploading(true);
    try {
      const res = await axios.post("/api/contacts/parse-csv", formData, {
        headers: {
          "Content-Type": "multipart/form-data",
        },
      });

      const contacts = res.data;
      if (!Array.isArray(contacts) || contacts.length === 0) {
        toast.error("‚ùå No valid contacts parsed from file.");
        return;
      }

      toast.success("‚úÖ CSV parsed successfully!");
      onUploadComplete(contacts, skipSaving);
      setFile(null); // üîÅ Reset file after success
      onClose();
    } catch (err) {
      console.error("‚ùå Upload error:", err);
      toast.error("‚ùå Failed to parse CSV. Please check format.");
    } finally {
      setUploading(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
      <div className="bg-white p-6 rounded-xl shadow-md w-full max-w-md space-y-4">
        <h2 className="text-xl font-bold text-purple-700">
          üì• Upload CSV File
        </h2>

        <input type="file" accept=".csv" onChange={handleFileChange} />

        <div className="flex items-center space-x-2">
          <input
            type="checkbox"
            checked={skipSaving}
            onChange={e => setSkipSaving(e.target.checked)}
          />
          <label className="text-sm">
            Don't save contacts to CRM (temporary)
          </label>
        </div>

        <div className="flex justify-end gap-3 mt-4">
          <button
            onClick={onClose}
            className="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-sm"
          >
            Cancel
          </button>
          <button
            onClick={handleUpload}
            disabled={uploading}
            className="px-4 py-2 rounded bg-purple-600 text-white hover:bg-purple-700 text-sm"
          >
            {uploading ? "‚è≥ Uploading..." : "üöÄ Upload"}
          </button>
        </div>
      </div>
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\ExtrackAllFiles.bat 
====================================================== 
 
@echo off
REM This script will find all files and output their name and content into one file.
REM The output file will be named [FolderName]_AllFileDump.txt.

REM Get the current folder's name and set it as the output file name with the custom suffix
for %%I in ("%cd%") do set "outputFile=%%~nI_AllFileDump.txt"

REM Clear the output file to start fresh
> "%outputFile%" (echo Folder and File Content Report)
echo. >> "%outputFile%"

REM Loop through all files in the current directory and subdirectories
for /R . %%F in (*.*) do (
    echo ====================================================== >> "%outputFile%"
    echo FILE: %%F >> "%outputFile%"
    echo ====================================================== >> "%outputFile%"
    echo. >> "%outputFile%"
    type "%%F" >> "%outputFile%" 2>nul
    echo. >> "%outputFile%"
    echo. >> "%outputFile%"
)

echo Finished! All content has been extracted to %outputFile% 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\components\BulkActionsBar.jsx 
====================================================== 
 
import React, { useEffect, useState } from "react";
import axiosClient from "../../../../api/axiosClient";
import { toast } from "react-toastify";

function BulkActionsBar({ selectedIds = [], onClearSelection, onRefresh }) {
  const [availableTags, setAvailableTags] = useState([]);
  const [selectedTagId, setSelectedTagId] = useState("");

  useEffect(() => {
    if (selectedIds.length > 0) {
      fetchTags();
    }
  }, [selectedIds.length]);

  const fetchTags = async () => {
    try {
      const res = await axiosClient.get("/tags/get-tags");
      setAvailableTags(res.data.data || []);
    } catch (error) {
      toast.error("‚ùå Failed to load tags");
    }
  };

  const handleApplyTag = async () => {
    if (!selectedTagId) {
      toast.warn("Please select a tag first");
      return;
    }

    try {
      await axiosClient.post("/contacts/bulk-assign-tag", {
        contactIds: selectedIds,
        tagId: selectedTagId,
      });

      toast.success("‚úÖ Tag assigned to selected contacts");
      onClearSelection?.();
      onRefresh?.();
    } catch (error) {
      const message =
        error.response?.data?.message || "‚ùå Failed to assign tag";
      toast.error(message);
    }
  };

  if (selectedIds.length === 0) return null;

  return (
    <div className="flex flex-col sm:flex-row justify-between items-center bg-blue-50 border border-blue-200 rounded-md p-3 mb-4 space-y-2 sm:space-y-0">
      <p className="text-sm text-gray-700 font-medium">
        {selectedIds.length} contact(s) selected
      </p>

      <div className="flex items-center gap-3 w-full sm:w-auto">
        <select
          value={selectedTagId}
          onChange={e => setSelectedTagId(e.target.value)}
          className="border border-gray-300 rounded-md px-3 py-2 text-sm w-full sm:w-56"
        >
          <option value="">-- Select Tag --</option>
          {availableTags.map(tag => (
            <option key={tag.id} value={tag.id}>
              {tag.name}
            </option>
          ))}
        </select>

        <button
          onClick={handleApplyTag}
          className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm shadow-sm"
        >
          Apply Tag
        </button>

        <button
          onClick={onClearSelection}
          className="text-sm text-gray-600 hover:underline"
        >
          Clear
        </button>
      </div>
    </div>
  );
}

export default BulkActionsBar;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\components\checkbox.jsx 
====================================================== 
 
// üìÑ File: src/pages/Contacts/components/checkbox.jsx

import React from "react";

export const Checkbox = React.forwardRef(
  ({ className = "", checked, onCheckedChange, ...props }, ref) => {
    return (
      <input
        type="checkbox"
        ref={ref}
        checked={checked}
        className={`w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500 ${className}`}
        {...props}
        onChange={e => onCheckedChange?.(e.target.checked)}
      />
    );
  }
);

Checkbox.displayName = "Checkbox";
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\components\ContactFormModal.jsx 
====================================================== 
 
import React, { useEffect, useState } from "react";
import axiosClient from "../../../../api/axiosClient";
import { toast } from "react-toastify";

const leadSources = [
  "Manual",
  "Website Form",
  "Google Search",
  "Facebook Ad",
  "LinkedIn",
  "Referral",
  "Trade Show",
  "Cold Call",
  "Other",
];

function ContactFormModal({ isOpen, onClose, contact, onSaveComplete }) {
  const [formData, setFormData] = useState({
    name: "",
    phoneNumber: "",
    email: "",
    leadSource: "Manual",
    notes: "",
    tagId: "",
  });
  const [allTags, setAllTags] = useState([]);
  const [isSaving, setIsSaving] = useState(false);

  useEffect(() => {
    const fetchTags = async () => {
      try {
        const res = await axiosClient.get("/tags/get-tags");
        setAllTags(res.data.data || []);
      } catch (error) {
        console.error("Failed to load tags:", error);
        toast.error("‚ùå Failed to load tags");
      }
    };

    if (isOpen) {
      fetchTags();
    }
  }, [isOpen]);

  useEffect(() => {
    if (contact) {
      setFormData({
        name: contact.name || "",
        phoneNumber: contact.phoneNumber || "",
        email: contact.email || "",
        leadSource: contact.leadSource || "Manual",
        notes: contact.notes || "",
        tagId: contact.tags?.[0]?.tagId || "",
      });
    } else {
      setFormData({
        name: "",
        phoneNumber: "",
        email: "",
        leadSource: "Manual",
        notes: "",
        tagId: "",
      });
    }
  }, [contact, isOpen]);

  const handleChange = e => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async e => {
    e.preventDefault();
    setIsSaving(true);

    const payload = {
      ...formData,
      tagIds: formData.tagId ? [formData.tagId] : [],
    };
    delete payload.tagId;

    try {
      if (contact?.id) {
        await axiosClient.put(`/contacts/${contact.id}`, payload); // Assuming PUT doesn't need "add"
        toast.success("‚úÖ Contact updated successfully!");
      } else {
        // üëá FIX #1: Using the correct endpoint for creating a contact.
        await axiosClient.post("/contacts/create", payload);
        toast.success("‚úÖ Contact created successfully!");
      }
      onSaveComplete?.();
      onClose();
    } catch (err) {
      // üëá FIX #2: Specific error handling for duplicate contacts.
      if (err.response && err.response.status === 409) {
        // 409 Conflict status means the contact already exists.
        toast.warn(
          err.response.data.message ||
            "Contact with this phone number already exists."
        );
      } else {
        // Handle all other errors (like 404 Not Found, 500 Server Error, etc.)
        const errorMessage =
          err.response?.data?.message || "‚ùå Failed to save contact.";
        toast.error(errorMessage);
      }
    } finally {
      setIsSaving(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center p-4">
      <div className="bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl relative">
        <button
          onClick={onClose}
          className="absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-2xl"
        >
          &times;
        </button>

        <h2 className="text-xl font-bold mb-4">
          {contact?.id ? "Edit Contact" : "Add New Contact"}
        </h2>

        <form
          onSubmit={handleSubmit}
          className="grid grid-cols-1 md:grid-cols-2 gap-4"
        >
          <input
            name="name"
            value={formData.name}
            onChange={handleChange}
            placeholder="Full Name *"
            required
            className="border px-3 py-2 rounded w-full"
          />
          <input
            name="phoneNumber"
            value={formData.phoneNumber}
            onChange={handleChange}
            placeholder="Phone Number *"
            required
            className="border px-3 py-2 rounded w-full"
          />
          <input
            type="email"
            name="email"
            value={formData.email}
            onChange={handleChange}
            placeholder="Email"
            className="border px-3 py-2 rounded w-full"
          />
          <select
            name="leadSource"
            value={formData.leadSource}
            onChange={handleChange}
            className="border px-3 py-2 rounded w-full"
          >
            {leadSources.map(source => (
              <option key={source} value={source}>
                {source}
              </option>
            ))}
          </select>
          <select
            name="tagId"
            value={formData.tagId}
            onChange={handleChange}
            className="md:col-span-2 border px-3 py-2 rounded w-full"
          >
            <option value="">-- No Tag --</option>
            {allTags.map(tag => (
              <option key={tag.id} value={tag.id}>
                {tag.name}
              </option>
            ))}
          </select>
          <textarea
            name="notes"
            value={formData.notes}
            onChange={handleChange}
            placeholder="Notes..."
            className="md:col-span-2 border px-3 py-2 rounded w-full min-h-[80px]"
          ></textarea>
          <div className="md:col-span-2 flex justify-end gap-3">
            <button
              type="button"
              onClick={onClose}
              className="bg-gray-200 text-gray-800 px-6 py-2 rounded hover:bg-gray-300"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={isSaving}
              className="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 disabled:bg-purple-300"
            >
              {isSaving
                ? "Saving..."
                : contact?.id
                ? "Update Contact"
                : "Add Contact"}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}

export default ContactFormModal;

// import React, { useEffect, useState } from "react";
// import axiosClient from "../../../api/axiosClient";
// import { toast } from "react-toastify";

// // üëá FIX #1: Define the list of lead sources.
// const leadSources = [
//   "Manual",
//   "Website Form",
//   "Google Search",
//   "Facebook Ad",
//   "LinkedIn",
//   "Referral",
//   "Trade Show",
//   "Cold Call",
//   "Other",
// ];

// function ContactFormModal({ isOpen, onClose, contact, onSaveComplete }) {
//   const [formData, setFormData] = useState({
//     name: "",
//     phoneNumber: "",
//     email: "",
//     // üëá FIX #2: Set the default leadSource to "Manual".
//     leadSource: "Manual",
//     notes: "",
//     tagId: "",
//   });
//   const [allTags, setAllTags] = useState([]);
//   const [isSaving, setIsSaving] = useState(false);

//   useEffect(() => {
//     const fetchTags = async () => {
//       try {
//         const res = await axiosClient.get("/tags/get-tags");
//         setAllTags(res.data.data || []);
//       } catch (error) {
//         console.error("Failed to load tags:", error);
//         toast.error("‚ùå Failed to load tags");
//       }
//     };

//     if (isOpen) {
//       fetchTags();
//     }
//   }, [isOpen]);

//   useEffect(() => {
//     if (contact) {
//       setFormData({
//         name: contact.name || "",
//         phoneNumber: contact.phoneNumber || "",
//         email: contact.email || "",
//         leadSource: contact.leadSource || "Manual",
//         notes: contact.notes || "",
//         tagId: contact.tags?.[0]?.tagId || "",
//       });
//     } else {
//       // Reset form for a new contact
//       setFormData({
//         name: "",
//         phoneNumber: "",
//         email: "",
//         leadSource: "Manual",
//         notes: "",
//         tagId: "",
//       });
//     }
//   }, [contact, isOpen]);

//   const handleChange = e => {
//     const { name, value } = e.target;
//     setFormData(prev => ({ ...prev, [name]: value }));
//   };

//   const handleSubmit = async e => {
//     e.preventDefault();
//     setIsSaving(true);

//     const payload = {
//       ...formData,
//       tagIds: formData.tagId ? [formData.tagId] : [],
//     };
//     delete payload.tagId;

//     try {
//       if (contact?.id) {
//         await axiosClient.put(`/contacts/add/${contact.id}`, payload);
//         toast.success("‚úÖ Contact updated successfully!");
//       } else {
//         await axiosClient.post("/contacts", payload);
//         toast.success("‚úÖ Contact created successfully!");
//       }
//       onSaveComplete?.();
//       onClose();
//     } catch (err) {
//       const errorMessage =
//         err.response?.data?.message || "‚ùå Failed to save contact.";
//       toast.error(errorMessage);
//     } finally {
//       setIsSaving(false);
//     }
//   };

//   if (!isOpen) return null;

//   return (
//     <div className="fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center p-4">
//       <div className="bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl relative">
//         <button
//           onClick={onClose}
//           className="absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-2xl"
//         >
//           &times;
//         </button>

//         <h2 className="text-xl font-bold mb-4">
//           {contact?.id ? "Edit Contact" : "Add New Contact"}
//         </h2>

//         <form
//           onSubmit={handleSubmit}
//           className="grid grid-cols-1 md:grid-cols-2 gap-4"
//         >
//           <input
//             name="name"
//             value={formData.name}
//             onChange={handleChange}
//             placeholder="Full Name *"
//             required
//             className="border px-3 py-2 rounded w-full"
//           />
//           <input
//             name="phoneNumber"
//             value={formData.phoneNumber}
//             onChange={handleChange}
//             placeholder="Phone Number *"
//             required
//             className="border px-3 py-2 rounded w-full"
//           />
//           <input
//             type="email"
//             name="email"
//             value={formData.email}
//             onChange={handleChange}
//             placeholder="Email"
//             className="border px-3 py-2 rounded w-full"
//           />

//           {/* üëá FIX #3: Replaced the text input with a select dropdown. */}
//           <select
//             name="leadSource"
//             value={formData.leadSource}
//             onChange={handleChange}
//             className="border px-3 py-2 rounded w-full"
//           >
//             {leadSources.map(source => (
//               <option key={source} value={source}>
//                 {source}
//               </option>
//             ))}
//           </select>

//           <select
//             name="tagId"
//             value={formData.tagId}
//             onChange={handleChange}
//             className="md:col-span-2 border px-3 py-2 rounded w-full"
//           >
//             <option value="">-- No Tag --</option>
//             {allTags.map(tag => (
//               <option key={tag.id} value={tag.id}>
//                 {tag.name}
//               </option>
//             ))}
//           </select>

//           <textarea
//             name="notes"
//             value={formData.notes}
//             onChange={handleChange}
//             placeholder="Notes..."
//             className="md:col-span-2 border px-3 py-2 rounded w-full min-h-[80px]"
//           ></textarea>

//           <div className="md:col-span-2 flex justify-end gap-3">
//             <button
//               type="button"
//               onClick={onClose}
//               className="bg-gray-200 text-gray-800 px-6 py-2 rounded hover:bg-gray-300"
//             >
//               Cancel
//             </button>
//             <button
//               type="submit"
//               disabled={isSaving}
//               className="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 disabled:bg-purple-300"
//             >
//               {isSaving
//                 ? "Saving..."
//                 : contact?.id
//                 ? "Update Contact"
//                 : "Add Contact"}
//             </button>
//           </div>
//         </form>
//       </div>
//     </div>
//   );
// }

// export default ContactFormModal;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\components\ContactsTable.jsx 
====================================================== 
 
// üìÑ File: src/pages/Contacts/components/ContactsTable.jsx
import React, { useEffect, useState, useCallback } from "react";
import axiosClient from "../../../../api/axiosClient";

import { useNavigate } from "react-router-dom";
import { toast } from "react-toastify";
import { Checkbox } from "./checkbox";
import { MoreVertical } from "lucide-react";
import {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
} from "./dropdown-menu";

function getInitials(name) {
  if (!name) return "";
  return name
    .split(" ")
    .slice(0, 2)
    .map(w => w[0])
    .join(" ")
    .toUpperCase();
}

export default function ContactsTable({
  onEdit,
  refreshTrigger,
  activeTab,
  onSelectionChange,
  searchTerm,
  currentPage,
  setCurrentPage,
}) {
  const [contacts, setContacts] = useState([]);
  const [totalPages, setTotalPages] = useState(1);
  const [selectedIds, setSelectedIds] = useState([]);
  const pageSize = 20;
  const navigate = useNavigate();

  const fetchContacts = useCallback(async () => {
    try {
      const res = await axiosClient.get("/contacts/", {
        params: {
          tab: activeTab,
          search: searchTerm,
          page: currentPage,
          pageSize,
        },
      });

      const result = res.data.data;

      // üëá THE FIX IS HERE üëá
      // The contacts are in `result.items`, not `result.records`.
      setContacts(Array.isArray(result?.items) ? result.items : []);

      // Also, handle the potentially incorrect totalPages from the backend.
      const total = result?.totalPages > 0 ? result.totalPages : 1;
      setTotalPages(total);
    } catch (err) {
      const message =
        err.response?.data?.message || "‚ùå Failed to load contacts";
      toast.error(message);
    }
  }, [activeTab, searchTerm, currentPage, pageSize]);

  useEffect(() => {
    fetchContacts();
  }, [refreshTrigger, activeTab, searchTerm, currentPage, fetchContacts]);

  const handleSelectAll = checked => {
    const ids = checked ? contacts.map(c => c.id) : [];
    setSelectedIds(ids);
    onSelectionChange?.(ids);
  };

  const handleRowCheckbox = (checked, id) => {
    const updated = checked
      ? [...selectedIds, id]
      : selectedIds.filter(i => i !== id);
    setSelectedIds(updated);
    onSelectionChange?.(updated);
  };

  const handleDelete = async id => {
    if (!window.confirm("Are you sure you want to delete this contact?"))
      return;
    try {
      await axiosClient.delete(`/contacts/${id}`);
      toast.success("‚úÖ Contact deleted");
      fetchContacts();
    } catch (err) {
      const message =
        err.response?.data?.message || "‚ùå Failed to delete contact";
      toast.error(message);
    }
  };

  return (
    <div className="overflow-x-auto rounded-lg border shadow-sm">
      <table className="w-full text-sm text-gray-700">
        <thead className="bg-gray-100">
          <tr>
            <th className="px-4 py-2 text-center w-6 border-b border-gray-200">
              <Checkbox
                checked={
                  contacts.length > 0 && selectedIds.length === contacts.length
                }
                onCheckedChange={handleSelectAll}
                className="w-4 h-4"
              />
            </th>
            <th className="px-4 py-2 text-left border-b border-gray-200 font-medium">
              Name
            </th>
            <th className="px-4 py-2 text-left border-b border-gray-200 font-medium">
              Phone
            </th>
            <th className="px-4 py-2 text-left border-b border-gray-200 font-medium hidden md:table-cell">
              Email
            </th>

            <th className="px-4 py-2 text-left border-b border-gray-200 font-medium hidden lg:table-cell">
              Created
            </th>
            <th className="px-4 py-2 text-center w-8 border-b border-gray-200 font-medium">
              Actions
            </th>
          </tr>
        </thead>
        <tbody className="bg-white divide-y divide-gray-200">
          {contacts.map(contact => (
            <tr key={contact.id} className="hover:bg-gray-50">
              <td className="px-4 py-2 text-center">
                <Checkbox
                  checked={selectedIds.includes(contact.id)}
                  onCheckedChange={checked =>
                    handleRowCheckbox(checked, contact.id)
                  }
                  className="w-4 h-4"
                />
              </td>
              <td className="px-4 py-2 flex items-center gap-4">
                <div className="h-6 w-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs">
                  {getInitials(contact.name)}
                </div>
                <span className="font-medium truncate">{contact.name}</span>
              </td>

              <td className="px-4 py-2 truncate">{contact.phoneNumber}</td>
              <td className="px-4 py-2 hidden md:table-cell truncate">
                {contact.email || "‚Äî"}
              </td>
              <td className="px-4 py-2 hidden lg:table-cell truncate">
                {new Date(contact.createdAt).toLocaleDateString()}
              </td>
              <td className="px-4 py-2 text-center">
                <DropdownMenu>
                  <DropdownMenuTrigger asChild>
                    <button className="p-1 rounded hover:bg-gray-200 focus:outline-none">
                      <MoreVertical size={16} />
                    </button>
                  </DropdownMenuTrigger>
                  <DropdownMenuContent className="w-36 rounded shadow-lg border bg-white">
                    <DropdownMenuItem
                      onClick={() => onEdit(contact)}
                      className="px-3 py-2 hover:bg-gray-100 text-xs"
                    >
                      ‚úèÔ∏è Edit
                    </DropdownMenuItem>
                    <DropdownMenuItem
                      onClick={() => handleDelete(contact.id)}
                      className="px-3 py-2 hover:bg-red-50 text-red-600 text-xs"
                    >
                      üóëÔ∏è Delete
                    </DropdownMenuItem>
                    <DropdownMenuItem
                      onClick={() =>
                        navigate(`/dashboard/contacts/${contact.id}/notes`)
                      }
                      className="px-3 py-2 hover:bg-gray-100 text-xs"
                    >
                      üìù Notes
                    </DropdownMenuItem>
                  </DropdownMenuContent>
                </DropdownMenu>
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      {/* Pagination Controls */}
      <div className="flex justify-end items-center gap-3 px-4 py-3 text-sm text-gray-700">
        <button
          onClick={() => setCurrentPage(p => Math.max(p - 1, 1))}
          disabled={currentPage === 1}
          className="px-3 py-1 border border-gray-300 rounded disabled:opacity-50"
        >
          Prev
        </button>
        <span>
          Page {currentPage} of {totalPages}
        </span>
        <button
          onClick={() => setCurrentPage(p => Math.min(p + 1, totalPages))}
          disabled={currentPage === totalPages}
          className="px-3 py-1 border border-gray-300 rounded disabled:opacity-50"
        >
          Next
        </button>
      </div>
    </div>
  );
}

// import React, { useEffect, useState, useCallback } from "react";
// import axiosClient from "../../../api/axiosClient";
// import { useNavigate } from "react-router-dom";
// import { toast } from "react-toastify";
// import { Checkbox } from "./checkbox";
// import { MoreVertical } from "lucide-react";
// import {
//   DropdownMenu,
//   DropdownMenuTrigger,
//   DropdownMenuContent,
//   DropdownMenuItem,
// } from "./dropdown-menu";

// function getInitials(name) {
//   if (!name) return "";
//   return name
//     .split(" ")
//     .slice(0, 2)
//     .map(w => w[0])
//     .join(" ")
//     .toUpperCase();
// }

// export default function ContactsTable({
//   onEdit,
//   refreshTrigger,
//   activeTab,
//   onSelectionChange,
//   searchTerm,
//   currentPage,
//   setCurrentPage,
// }) {
//   const [contacts, setContacts] = useState([]);
//   const [selectedIds, setSelectedIds] = useState([]);
//   const pageSize = 20;
//   const navigate = useNavigate();

//   // üü¢ useCallback so it's safe to add as dependency
//   const fetchContacts = useCallback(async () => {
//     try {
//       const res = await axiosClient.get("/contacts", {
//         params: { tab: activeTab, search: searchTerm },
//       });
//       const result = res.data;
//       const records = Array.isArray(result?.records) ? result.records : [];
//       setContacts(records);
//     } catch {
//       toast.error("‚ùå Failed to load contacts");
//     }
//   }, [activeTab, searchTerm]);

//   useEffect(() => {
//     fetchContacts();
//   }, [refreshTrigger, activeTab, searchTerm, fetchContacts]);

//   const handleSelectAll = checked => {
//     const ids = checked ? pagedContacts.map(c => c.id) : [];
//     setSelectedIds(ids);
//     onSelectionChange?.(ids);
//   };

//   const handleRowCheckbox = (checked, id) => {
//     const updated = checked
//       ? [...selectedIds, id]
//       : selectedIds.filter(i => i !== id);
//     setSelectedIds(updated);
//     onSelectionChange?.(updated);
//   };

//   const handleDelete = async id => {
//     if (!window.confirm("Are you sure you want to delete this contact?"))
//       return;
//     try {
//       await axiosClient.delete(`/contacts/${id}`);
//       toast.success("‚úÖ Contact deleted");
//       fetchContacts();
//     } catch {
//       toast.error("‚ùå Failed to delete contact");
//     }
//   };

//   const filtered = contacts.filter(c =>
//     c.name.toLowerCase().includes(searchTerm.toLowerCase())
//   );
//   const sorted = [...filtered].sort(
//     (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
//   );
//   const totalPages = Math.max(1, Math.ceil(sorted.length / pageSize));
//   const pagedContacts = sorted.slice(
//     (currentPage - 1) * pageSize,
//     currentPage * pageSize
//   );

//   return (
//     <div className="overflow-x-auto rounded-lg border shadow-sm">
//       <table className="w-full text-sm text-gray-700">
//         <thead className="bg-gray-100">
//           <tr>
//             <th className="px-4 py-2 text-center w-6 border-b border-gray-200">
//               <Checkbox
//                 checked={
//                   pagedContacts.length > 0 &&
//                   selectedIds.length === pagedContacts.length
//                 }
//                 onCheckedChange={handleSelectAll}
//                 className="w-4 h-4"
//               />
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium">
//               Name
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium hidden md:table-cell">
//               Email
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium">
//               Phone
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium hidden lg:table-cell">
//               Created
//             </th>
//             <th className="px-4 py-2 text-center w-8 border-b border-gray-200 font-medium">
//               Actions
//             </th>
//           </tr>
//         </thead>
//         <tbody className="bg-white divide-y divide-gray-200">
//           {pagedContacts.map(contact => (
//             <tr key={contact.id} className="hover:bg-gray-50">
//               <td className="px-4 py-2 text-center">
//                 <Checkbox
//                   checked={selectedIds.includes(contact.id)}
//                   onCheckedChange={checked =>
//                     handleRowCheckbox(checked, contact.id)
//                   }
//                   className="w-4 h-4"
//                 />
//               </td>
//               <td className="px-4 py-2 flex items-center gap-4">
//                 <div className="h-6 w-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs">
//                   {getInitials(contact.name)}
//                 </div>
//                 <span className="font-medium truncate">{contact.name}</span>
//               </td>
//               <td className="px-4 py-2 hidden md:table-cell truncate">
//                 {contact.email || "‚Äî"}
//               </td>
//               <td className="px-4 py-2 truncate">{contact.phoneNumber}</td>
//               <td className="px-4 py-2 hidden lg:table-cell truncate">
//                 {new Date(contact.createdAt).toLocaleDateString()}
//               </td>
//               <td className="px-4 py-2 text-center">
//                 <DropdownMenu>
//                   <DropdownMenuTrigger asChild>
//                     <button className="p-1 rounded hover:bg-gray-200 focus:outline-none">
//                       <MoreVertical size={16} />
//                     </button>
//                   </DropdownMenuTrigger>
//                   <DropdownMenuContent className="w-36 rounded shadow-lg border bg-white">
//                     <DropdownMenuItem
//                       onClick={() => onEdit(contact)}
//                       className="px-3 py-2 hover:bg-gray-100 text-xs"
//                     >
//                       ‚úèÔ∏è Edit
//                     </DropdownMenuItem>
//                     <DropdownMenuItem
//                       onClick={() => handleDelete(contact.id)}
//                       className="px-3 py-2 hover:bg-red-50 text-red-600 text-xs"
//                     >
//                       üóëÔ∏è Delete
//                     </DropdownMenuItem>
//                     <DropdownMenuItem
//                       onClick={() =>
//                         navigate(`/dashboard/contacts/${contact.id}/notes`)
//                       }
//                       className="px-3 py-2 hover:bg-gray-100 text-xs"
//                     >
//                       üìù Notes
//                     </DropdownMenuItem>
//                   </DropdownMenuContent>
//                 </DropdownMenu>
//               </td>
//             </tr>
//           ))}
//         </tbody>
//       </table>

//       {/* Pagination Controls */}
//       <div className="flex justify-end items-center gap-3 px-4 py-3 text-sm text-gray-700">
//         <button
//           onClick={() => setCurrentPage(p => Math.max(p - 1, 1))}
//           disabled={currentPage === 1}
//           className="px-3 py-1 border border-gray-300 rounded disabled:opacity-50"
//         >
//           Prev
//         </button>
//         <span>
//           Page {currentPage} of {totalPages}
//         </span>
//         <button
//           onClick={() => setCurrentPage(p => Math.min(p + 1, totalPages))}
//           disabled={currentPage === totalPages}
//           className="px-3 py-1 border border-gray-300 rounded disabled:opacity-50"
//         >
//           Next
//         </button>
//       </div>
//     </div>
//   );
// }

// import React, { useEffect, useState } from "react";
// import axiosClient from "../../../api/axiosClient";
// import { useNavigate } from "react-router-dom";
// import { toast } from "react-toastify";
// import { Checkbox } from "./checkbox";
// import { MoreVertical } from "lucide-react";
// import {
//   DropdownMenu,
//   DropdownMenuTrigger,
//   DropdownMenuContent,
//   DropdownMenuItem,
// } from "./dropdown-menu";

// function getInitials(name) {
//   if (!name) return "";
//   return name
//     .split(" ")
//     .slice(0, 2)
//     .map(w => w[0])
//     .join(" ")
//     .toUpperCase();
// }

// export default function ContactsTable({
//   onEdit,
//   refreshTrigger,
//   activeTab,
//   onSelectionChange,
//   searchTerm,
//   currentPage,
//   setCurrentPage,
// }) {
//   const [contacts, setContacts] = useState([]);
//   const [selectedIds, setSelectedIds] = useState([]);
//   const pageSize = 20;
//   const navigate = useNavigate();

//   useEffect(() => {
//     fetchContacts();
//   }, [refreshTrigger, activeTab, searchTerm]);

//   const fetchContacts = async () => {
//     try {
//       const res = await axiosClient.get("/contacts", {
//         params: { tab: activeTab, search: searchTerm },
//       });
//       const result = res.data;
//       const records = Array.isArray(result?.records) ? result.records : [];
//       setContacts(records);
//     } catch {
//       toast.error("‚ùå Failed to load contacts");
//     }
//   };

//   const handleSelectAll = checked => {
//     const ids = checked ? pagedContacts.map(c => c.id) : [];
//     setSelectedIds(ids);
//     onSelectionChange?.(ids);
//   };

//   const handleRowCheckbox = (checked, id) => {
//     const updated = checked
//       ? [...selectedIds, id]
//       : selectedIds.filter(i => i !== id);
//     setSelectedIds(updated);
//     onSelectionChange?.(updated);
//   };

//   const handleDelete = async id => {
//     if (!window.confirm("Are you sure you want to delete this contact?"))
//       return;
//     try {
//       await axiosClient.delete(`/contacts/${id}`);
//       toast.success("‚úÖ Contact deleted");
//       fetchContacts();
//     } catch {
//       toast.error("‚ùå Failed to delete contact");
//     }
//   };

//   const filtered = contacts.filter(c =>
//     c.name.toLowerCase().includes(searchTerm.toLowerCase())
//   );
//   const sorted = [...filtered].sort(
//     (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
//   );
//   const totalPages = Math.max(1, Math.ceil(sorted.length / pageSize));
//   const pagedContacts = sorted.slice(
//     (currentPage - 1) * pageSize,
//     currentPage * pageSize
//   );

//   return (
//     <div className="overflow-x-auto rounded-lg border shadow-sm">
//       <table className="w-full text-sm text-gray-700">
//         <thead className="bg-gray-100">
//           <tr>
//             <th className="px-4 py-2 text-center w-6 border-b border-gray-200">
//               <Checkbox
//                 checked={
//                   pagedContacts.length > 0 &&
//                   selectedIds.length === pagedContacts.length
//                 }
//                 onCheckedChange={handleSelectAll}
//                 className="w-4 h-4"
//               />
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium">
//               Name
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium hidden md:table-cell">
//               Email
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium">
//               Phone
//             </th>
//             <th className="px-4 py-2 text-left border-b border-gray-200 font-medium hidden lg:table-cell">
//               Created
//             </th>
//             <th className="px-4 py-2 text-center w-8 border-b border-gray-200 font-medium">
//               Actions
//             </th>
//           </tr>
//         </thead>
//         <tbody className="bg-white divide-y divide-gray-200">
//           {pagedContacts.map(contact => (
//             <tr key={contact.id} className="hover:bg-gray-50">
//               <td className="px-4 py-2 text-center">
//                 <Checkbox
//                   checked={selectedIds.includes(contact.id)}
//                   onCheckedChange={checked =>
//                     handleRowCheckbox(checked, contact.id)
//                   }
//                   className="w-4 h-4"
//                 />
//               </td>
//               <td className="px-4 py-2 flex items-center gap-4">
//                 <div className="h-6 w-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs">
//                   {getInitials(contact.name)}
//                 </div>
//                 <span className="font-medium truncate">{contact.name}</span>
//               </td>
//               <td className="px-4 py-2 hidden md:table-cell truncate">
//                 {contact.email || "‚Äî"}
//               </td>
//               <td className="px-4 py-2 truncate">{contact.phoneNumber}</td>
//               <td className="px-4 py-2 hidden lg:table-cell truncate">
//                 {new Date(contact.createdAt).toLocaleDateString()}
//               </td>
//               <td className="px-4 py-2 text-center">
//                 <DropdownMenu>
//                   <DropdownMenuTrigger asChild>
//                     <button className="p-1 rounded hover:bg-gray-200 focus:outline-none">
//                       <MoreVertical size={16} />
//                     </button>
//                   </DropdownMenuTrigger>
//                   <DropdownMenuContent className="w-36 rounded shadow-lg border bg-white">
//                     <DropdownMenuItem
//                       onClick={() => onEdit(contact)}
//                       className="px-3 py-2 hover:bg-gray-100 text-xs"
//                     >
//                       ‚úèÔ∏è Edit
//                     </DropdownMenuItem>
//                     <DropdownMenuItem
//                       onClick={() => handleDelete(contact.id)}
//                       className="px-3 py-2 hover:bg-red-50 text-red-600 text-xs"
//                     >
//                       üóëÔ∏è Delete
//                     </DropdownMenuItem>
//                     <DropdownMenuItem
//                       onClick={() =>
//                         navigate(`/dashboard/contacts/${contact.id}/notes`)
//                       }
//                       className="px-3 py-2 hover:bg-gray-100 text-xs"
//                     >
//                       üìù Notes
//                     </DropdownMenuItem>
//                   </DropdownMenuContent>
//                 </DropdownMenu>
//               </td>
//             </tr>
//           ))}
//         </tbody>
//       </table>

//       {/* Pagination Controls */}
//       <div className="flex justify-end items-center gap-3 px-4 py-3 text-sm text-gray-700">
//         <button
//           onClick={() => setCurrentPage(p => Math.max(p - 1, 1))}
//           disabled={currentPage === 1}
//           className="px-3 py-1 border border-gray-300 rounded disabled:opacity-50"
//         >
//           Prev
//         </button>
//         <span>
//           Page {currentPage} of {totalPages}
//         </span>
//         <button
//           onClick={() => setCurrentPage(p => Math.min(p + 1, totalPages))}
//           disabled={currentPage === totalPages}
//           className="px-3 py-1 border border-gray-300 rounded disabled:opacity-50"
//         >
//           Next
//         </button>
//       </div>
//     </div>
//   );
// }
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\components\ContactsTopBar.jsx 
====================================================== 
 
// üìÑ File: src/pages/Contacts/components/ContactsTopBar.jsx
import { Search, Plus, SlidersHorizontal } from "lucide-react";

export default function ContactsTopBar({
  onAddClick,
  onSearchChange,
  activeTab,
  onTabChange,
  searchTerm,
  onFilterClick,
}) {
  const tabs = [
    { key: "all", label: "All" },
    { key: "favourites", label: "Favourites" },
    { key: "archived", label: "Archived" },
    { key: "groups", label: "Groups" },
  ];

  return (
    <div className="space-y-3">
      {/* üîç Search + Buttons */}
      <div className="flex flex-col md:flex-row md:items-center justify-between gap-3 border-b pb-4">
        <div className="flex items-center gap-2 flex-1">
          <Search size={18} className="text-gray-500" />
          <input
            type="text"
            placeholder="Search contacts..."
            value={searchTerm}
            onChange={e => onSearchChange?.(e.target.value)}
            className="w-full md:max-w-xs border border-gray-300 rounded-md px-3 py-2 text-sm"
          />
        </div>
        <div className="flex items-center gap-3">
          <button
            onClick={onFilterClick}
            className="flex items-center gap-2 px-3 py-2 rounded-md text-sm border text-gray-600 border-gray-300 hover:bg-gray-100"
          >
            <SlidersHorizontal size={16} /> Filter
          </button>
          <button
            onClick={onAddClick}
            className="flex items-center gap-2 px-4 py-2 rounded-md text-sm bg-purple-600 hover:bg-purple-700 text-white shadow-sm"
          >
            <Plus size={16} /> Add Contact
          </button>
        </div>
      </div>

      {/* üß≠ Tab Navigation */}
      <div className="flex gap-3 border-b text-sm font-medium">
        {tabs.map(tab => (
          <button
            key={tab.key}
            onClick={() => onTabChange?.(tab.key)}
            className={`px-3 py-2 border-b-2 transition-all duration-150 ${
              activeTab === tab.key
                ? "border-purple-600 text-purple-600"
                : "border-transparent text-gray-500 hover:text-black"
            }`}
          >
            {tab.label}
          </button>
        ))}
      </div>
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Contacts\components\dropdown-menu.jsx 
====================================================== 
 
// üìÑ File: src/pages/Contacts/components/dropdown-menu.jsx
import {
  Menu,
  MenuButton,
  MenuItems,
  MenuItem,
  Transition,
} from "@headlessui/react";
import { Fragment } from "react";

export function DropdownMenu({ children }) {
  return (
    <Menu as="div" className="relative inline-block text-left">
      {children}
    </Menu>
  );
}

export const DropdownMenuTrigger = ({ asChild, children }) => (
  <MenuButton as={Fragment}>{children}</MenuButton>
);

export const DropdownMenuContent = ({ children, className = "" }) => (
  <Transition
    as={Fragment}
    enter="transition ease-out duration-100"
    enterFrom="transform opacity-0 scale-95"
    enterTo="transform opacity-100 scale-100"
    leave="transition ease-in duration-75"
    leaveFrom="transform opacity-100 scale-100"
    leaveTo="transform opacity-0 scale-95"
  >
    <MenuItems
      className={`absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none ${className}`}
    >
      {children}
    </MenuItems>
  </Transition>
);

export const DropdownMenuItem = ({ children, onClick, className = "" }) => (
  <MenuItem>
    {({ active }) => (
      <button
        onClick={onClick}
        className={`${
          active ? "bg-gray-100" : ""
        } w-full px-4 py-2 text-sm text-left ${className}`}
      >
        {children}
      </button>
    )}
  </MenuItem>
);

// // üìÑ File: src/pages/Contacts/components/dropdown-menu.jsx
// import {
//   Menu,
//   MenuButton,
//   MenuItems,
//   MenuItem,
//   Transition,
// } from "@headlessui/react";
// import { Fragment } from "react";

// export function DropdownMenu({ children }) {
//   return (
//     <Menu as="div" className="relative inline-block text-left">
//       {children}
//     </Menu>
//   );
// }

// export const DropdownMenuTrigger = ({ asChild, children }) => (
//   <MenuButton as={Fragment}>{children}</MenuButton>
// );

// export const DropdownMenuContent = ({ children, className = "" }) => (
//   <Transition
//     as={Fragment}
//     enter="transition ease-out duration-100"
//     enterFrom="transform opacity-0 scale-95"
//     enterTo="transform opacity-100 scale-100"
//     leave="transition ease-in duration-75"
//     leaveFrom="transform opacity-100 scale-100"
//     leaveTo="transform opacity-0 scale-95"
//   >
//     <MenuItems
//       className={`absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none ${className}`}
//     >
//       {children}
//     </MenuItems>
//   </Transition>
// );

// export const DropdownMenuItem = ({ children, onClick, className = "" }) => (
//   <MenuItem>
//     {({ active }) => (
//       <button
//         onClick={onClick}
//         className={`${
//           active ? "bg-gray-100" : ""
//         } w-full px-4 py-2 text-sm text-left ${className}`}
//       >
//         {children}
//       </button>
//     )}
//   </MenuItem>
// );
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Notes\NoteForm.jsx 
====================================================== 
 
import React, { useEffect, useState } from "react";
import axios from "axios";
import axiosClient from "../../../api/axiosClient";
import { toast } from "react-toastify";

function NoteForm({ contactId, selectedNote, onSaveComplete }) {
  const [formData, setFormData] = useState({
    contactId: contactId,
    title: "",
    content: "",
    source: "Manual",
    createdBy: "Admin", // Later: pull from auth
    isPinned: false,
    isInternal: false,
  });

  useEffect(() => {
    if (selectedNote) {
      setFormData({ ...selectedNote });
    } else {
      setFormData({
        contactId: contactId,
        title: "",
        content: "",
        source: "Manual",
        createdBy: "Admin",
        isPinned: false,
        isInternal: false,
      });
    }
  }, [selectedNote, contactId]);

  const handleChange = e => {
    const { name, value, type, checked } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === "checkbox" ? checked : value,
    }));
  };

  const handleSubmit = async e => {
    e.preventDefault();
    try {
      const payload = { ...formData, contactId };

      if (selectedNote?.id) {
        await axios.put(`/api/notes/${selectedNote.id}`, payload);
        toast.info("üìù Note updated.");
      } else {
        await axios.post("/api/notes", payload);
        toast.success("‚úÖ Note added.");
      }

      // ‚úÖ Auto-log to timeline
      try {
        await axiosClient.post("/leadtimeline", {
          contactId,
          eventType: "NoteAdded",
          description: `Note titled '${payload.title}' was ${
            selectedNote ? "updated" : "added"
          }.`,
          createdBy: payload.createdBy,
          source: "Note",
          category: "Manual",
          isSystemGenerated: true,
        });
      } catch (timelineErr) {
        console.warn("Timeline log failed:", timelineErr);
      }

      onSaveComplete();
    } catch (err) {
      console.error("‚ùå Failed to save note:", err);
      toast.error("Failed to save note.");
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-3">
      <input
        name="title"
        value={formData.title}
        onChange={handleChange}
        placeholder="Note Title"
        className="w-full border rounded-lg px-3 py-2"
      />
      <textarea
        name="content"
        value={formData.content}
        onChange={handleChange}
        placeholder="Write your note here..."
        rows={5}
        className="w-full border rounded-lg px-3 py-2"
      />
      <div className="flex flex-wrap gap-4">
        <label className="flex items-center">
          <input
            type="checkbox"
            name="isPinned"
            checked={formData.isPinned}
            onChange={handleChange}
            className="mr-2"
          />
          Pin Note
        </label>
        <label className="flex items-center">
          <input
            type="checkbox"
            name="isInternal"
            checked={formData.isInternal}
            onChange={handleChange}
            className="mr-2"
          />
          Internal Only
        </label>
      </div>
      <button
        type="submit"
        className="bg-purple-600 text-white px-4 py-2 rounded-lg"
      >
        {selectedNote ? "Update Note" : "Add Note"}
      </button>
    </form>
  );
}

export default NoteForm;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Notes\NoteList.jsx 
====================================================== 
 
import React, { useEffect, useState, useCallback } from "react";
import axios from "axios";

function NoteList({ contactId, onEdit, refreshKey }) {
  const [notes, setNotes] = useState([]);

  // üü¢ Wrap fetchNotes in useCallback so its identity is stable across renders
  const fetchNotes = useCallback(async () => {
    if (!contactId) return;
    try {
      const res = await axios.get(`/api/notes/contact/${contactId}`);
      setNotes(res.data);
    } catch (err) {
      console.error("‚ùå Failed to fetch notes:", err);
    }
  }, [contactId]);

  useEffect(() => {
    fetchNotes();
  }, [fetchNotes, refreshKey]); // useCallback ensures fetchNotes is stable

  const handleDelete = async id => {
    if (!window.confirm("Delete this note?")) return;
    try {
      await axios.delete(`/api/notes/${id}`);
      fetchNotes();
    } catch (err) {
      console.error("‚ùå Failed to delete note:", err);
    }
  };

  return (
    <div className="grid gap-4">
      {notes.length === 0 && (
        <div className="text-gray-500 text-center py-6">
          No notes found for this contact.
        </div>
      )}

      {notes.map(note => (
        <div
          key={note.id}
          className={`border p-4 rounded-xl shadow-sm relative bg-white hover:shadow-md transition-all ${
            note.isPinned ? "border-purple-500" : "border-gray-200"
          }`}
        >
          <div className="flex justify-between items-center">
            <h3 className="font-semibold text-lg text-purple-700 flex gap-2 items-center">
              {note.title || "Untitled"}
              {note.isPinned && (
                <span title="Pinned" className="text-purple-500">
                  üìå
                </span>
              )}
              {note.isInternal && (
                <span title="Internal Note" className="text-gray-400">
                  üîí
                </span>
              )}
            </h3>
            <div className="flex gap-2 text-sm">
              <button
                onClick={() => onEdit(note)}
                className="text-blue-600 hover:underline"
              >
                Edit
              </button>
              <button
                onClick={() => handleDelete(note.id)}
                className="text-red-500 hover:underline"
              >
                Delete
              </button>
            </div>
          </div>
          <p className="text-sm text-gray-800 mt-2 whitespace-pre-line">
            {note.content}
          </p>
          <div className="text-xs text-gray-500 mt-3">
            Created by <b>{note.createdBy}</b> ¬∑{" "}
            {new Date(note.createdAt).toLocaleString()}
          </div>
        </div>
      ))}
    </div>
  );
}

export default NoteList;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Notes\Notes.jsx 
====================================================== 
 
import React, { useState } from "react";
import NoteForm from "./NoteForm";
import NoteList from "./NoteList";

function Notes({ contactId }) {
  const [selectedNote, setSelectedNote] = useState(null);
  const [isDrawerOpen, setIsDrawerOpen] = useState(false);
  const [refreshKey, setRefreshKey] = useState(0);

  const handleEdit = note => {
    setSelectedNote(note);
    setIsDrawerOpen(true);
  };

  const handleAddNew = () => {
    setSelectedNote(null);
    setIsDrawerOpen(true);
  };

  const handleSaveComplete = () => {
    setSelectedNote(null);
    setIsDrawerOpen(false);
    setRefreshKey(prev => prev + 1);
  };

  return (
    <div className="p-4 relative">
      {/* Header */}
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-2xl font-semibold text-purple-700">üìù Notes</h2>
        <button
          onClick={handleAddNew}
          className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg shadow"
        >
          ‚ûï Add Note
        </button>
      </div>

      {/* Note List */}
      <NoteList
        contactId={contactId}
        onEdit={handleEdit}
        refreshKey={refreshKey}
      />

      {/* Drawer */}
      {isDrawerOpen && (
        <div className="fixed top-0 right-0 w-full max-w-md h-full bg-white shadow-2xl z-50 transition-transform duration-300 border-l overflow-y-auto">
          <div className="flex items-center justify-between p-4 border-b">
            <h2 className="text-lg font-bold">
              {selectedNote ? "Edit Note" : "Add Note"}
            </h2>
            <button
              onClick={() => setIsDrawerOpen(false)}
              className="text-gray-500 text-xl"
            >
              √ó
            </button>
          </div>
          <div className="p-4">
            <NoteForm
              contactId={contactId}
              selectedNote={selectedNote}
              onSaveComplete={handleSaveComplete}
            />
          </div>
        </div>
      )}
    </div>
  );
}

export default Notes;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Notes\NotesWrapper.jsx 
====================================================== 
 
import { useParams } from "react-router-dom";
import Notes from "./Notes";

function NotesWrapper() {
  const { contactId } = useParams();
  return <Notes contactId={contactId} />;
}

export default NotesWrapper;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Notes\MakeDump.bat 
====================================================== 
 
@echo off
REM This script will find relevant source files and output their names and contents into one file.
REM The output file will be named [FolderName]_AllFileDump.txt.

REM Get the current folder's name and set it as the output file name with the custom suffix
for %%I in ("%cd%") do set "outputFile=%%~nI_AllFileDump.txt"

REM Clear the output file to start fresh and write a small header
> "%outputFile%" (
    echo Folder and File Content Report
    echo Root folder: %cd%
    echo Generated at: %date% %time%
)
echo. >> "%outputFile%"

REM NOTE:
REM We now only dump RELEVANT text/code files (no binaries, no images, no node_modules, etc.)
REM This keeps the file smaller and much easier to review.

REM Loop through all relevant files in the current directory and subdirectories
REM Extensions included: C#, JS/TS/React, JSON, config, SQL, Markdown, YAML
for /R . %%F in (*.cs *.csproj *.jsx *.tsx *.js *.ts *.json *.config *.sql *.md *.yml *.yaml *.bat) do (

    REM Skip some noisy folders by path substring (node_modules, bin, obj, .git, dist, .vs)
    echo "%%F" | findstr /I /C:"\node_modules\" /C:"\bin\" /C:"\obj\" /C:"\.git\" /C:"\dist\" /C:"\.vs\" >nul
    if errorlevel 1 (
        echo ====================================================== >> "%outputFile%"
        echo FILE: %%F >> "%outputFile%"
        echo ====================================================== >> "%outputFile%"
        echo. >> "%outputFile%"
        type "%%F" >> "%outputFile%" 2>nul
        echo. >> "%outputFile%"
        echo. >> "%outputFile%"
    )
)

echo Finished! All content has been extracted to %outputFile%
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Reminders\ReminderForm.jsx 
====================================================== 
 
import React, { useEffect, useState } from "react";
import axios from "axios";
import axiosClient from "../../../api/axiosClient";
import { toast } from "react-toastify";

function ReminderForm({ selectedReminder, onSaveComplete }) {
  const [formData, setFormData] = useState({
    contactId: "3fa85f64-5717-4562-b3fc-2c963f66afa6", // Will be dynamic later
    title: "",
    description: "",
    dueAt: "",
    reminderType: "",
    priority: 2,
    isRecurring: false,
    recurrencePattern: "",
    sendWhatsappNotification: false,
    linkedCampaign: "",
    status: "Pending",
  });

  useEffect(() => {
    if (selectedReminder) {
      setFormData({ ...selectedReminder });
    } else {
      setFormData({
        contactId: "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        title: "",
        description: "",
        dueAt: "",
        reminderType: "",
        priority: 2,
        isRecurring: false,
        recurrencePattern: "",
        sendWhatsappNotification: false,
        linkedCampaign: "",
        status: "Pending",
      });
    }
  }, [selectedReminder]);

  const handleChange = e => {
    const { name, value, type, checked } = e.target;
    const val = type === "checkbox" ? checked : value;
    setFormData(prev => ({ ...prev, [name]: val }));
  };

  const handleSubmit = async e => {
    e.preventDefault();

    try {
      let isNew = false;

      if (selectedReminder?.id) {
        await axios.put(`/api/reminders/${selectedReminder.id}`, formData);
        toast.info("üîÑ Reminder updated.");
      } else {
        await axios.post("/api/reminders", formData);
        toast.success("‚úÖ Reminder added.");
        isNew = true;
      }

      // ‚úÖ Auto-log to timeline
      try {
        const { title, dueAt, priority, contactId } = formData;

        const priorityLabel =
          {
            1: "High",
            2: "Medium",
            3: "Low",
          }[priority] || "Medium";

        const formattedDate = new Date(dueAt).toLocaleString();

        await axiosClient.post("/leadtimeline", {
          contactId,
          eventType: "ReminderSet",
          description: `Reminder titled '${title}' ${
            isNew ? "added" : "updated"
          } for ${formattedDate} with priority ${priorityLabel}.`,
          createdBy: "System",
          source: "Reminder",
          category: "Auto",
          isSystemGenerated: true,
        });
      } catch (timelineErr) {
        console.warn("‚ö†Ô∏è Timeline log failed:", timelineErr);
      }

      onSaveComplete();
    } catch (err) {
      if (err.response) {
        console.error("üì¶ Backend error response:", err.response.data);
      } else {
        console.error("‚ùå Unknown error while saving reminder:", err);
      }
      toast.error("‚ùå Failed to save reminder.");
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-3">
      <input
        name="title"
        value={formData.title}
        onChange={handleChange}
        placeholder="Reminder Title"
        className="w-full border rounded-lg px-3 py-2"
        required
      />
      <textarea
        name="description"
        value={formData.description}
        onChange={handleChange}
        placeholder="Description"
        className="w-full border rounded-lg px-3 py-2"
      />
      <input
        type="datetime-local"
        name="dueAt"
        value={formData.dueAt}
        onChange={handleChange}
        className="w-full border rounded-lg px-3 py-2"
        required
      />
      <input
        name="reminderType"
        value={formData.reminderType}
        onChange={handleChange}
        placeholder="Type (e.g., Call, Email)"
        className="w-full border rounded-lg px-3 py-2"
      />
      <select
        name="priority"
        value={formData.priority}
        onChange={handleChange}
        className="w-full border rounded-lg px-3 py-2"
      >
        <option value={1}>High</option>
        <option value={2}>Medium</option>
        <option value={3}>Low</option>
      </select>
      <div className="flex gap-4 flex-wrap">
        <label className="flex items-center">
          <input
            type="checkbox"
            name="isRecurring"
            checked={formData.isRecurring}
            onChange={handleChange}
            className="mr-2"
          />
          Recurring
        </label>
        <input
          name="recurrencePattern"
          value={formData.recurrencePattern}
          onChange={handleChange}
          placeholder="e.g., Weekly"
          className="flex-1 border rounded-lg px-3 py-2"
        />
      </div>
      <label className="flex items-center">
        <input
          type="checkbox"
          name="sendWhatsappNotification"
          checked={formData.sendWhatsappNotification}
          onChange={handleChange}
          className="mr-2"
        />
        Send WhatsApp Notification
      </label>
      <button
        type="submit"
        className="bg-purple-600 text-white px-4 py-2 rounded-lg"
      >
        {selectedReminder ? "Update Reminder" : "Add Reminder"}
      </button>
    </form>
  );
}

export default ReminderForm;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Reminders\ReminderList.jsx 
====================================================== 
 
import React, { useEffect, useState } from "react";
import axios from "axios";

function ReminderList({ onEdit, refreshKey }) {
  const [reminders, setReminders] = useState([]);

  useEffect(() => {
    fetchReminders();
  }, [refreshKey]);

  const fetchReminders = async () => {
    try {
      const res = await axios.get("/api/reminders");
      setReminders(res.data);
    } catch (err) {
      console.error("‚ùå Failed to fetch reminders:", err);
    }
  };

  const handleDelete = async id => {
    const confirmDelete = window.confirm("Delete this reminder?");
    if (!confirmDelete) return;

    try {
      await axios.delete(`/api/reminders/${id}`);
      fetchReminders();
    } catch (err) {
      console.error("‚ùå Failed to delete reminder:", err);
    }
  };

  return (
    <div className="overflow-x-auto">
      <table className="w-full border text-left rounded-lg">
        <thead className="bg-gray-100 text-sm font-semibold">
          <tr>
            <th className="p-2">Title</th>
            <th className="p-2">Due At</th>
            <th className="p-2">Status</th>
            <th className="p-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          {reminders.map(reminder => (
            <tr key={reminder.id} className="border-t">
              <td className="p-2">{reminder.title}</td>
              <td className="p-2">
                {new Date(reminder.dueAt).toLocaleString()}
              </td>
              <td className="p-2">{reminder.status}</td>
              <td className="p-2 flex gap-2">
                <button
                  onClick={() => onEdit(reminder)}
                  className="px-2 py-1 text-sm bg-blue-500 text-white rounded"
                >
                  Edit
                </button>
                <button
                  onClick={() => handleDelete(reminder.id)}
                  className="px-2 py-1 text-sm bg-red-500 text-white rounded"
                >
                  Delete
                </button>
              </td>
            </tr>
          ))}
          {reminders.length === 0 && (
            <tr>
              <td colSpan="4" className="text-center py-4 text-gray-500">
                No reminders found.
              </td>
            </tr>
          )}
        </tbody>
      </table>
    </div>
  );
}

export default ReminderList;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Reminders\Reminders.jsx 
====================================================== 
 
import React, { useState } from "react";
import ReminderForm from "./ReminderForm";
import ReminderList from "./ReminderList";

function Reminders() {
  const [selectedReminder, setSelectedReminder] = useState(null);
  const [refreshKey, setRefreshKey] = useState(0);
  const [isDrawerOpen, setIsDrawerOpen] = useState(false);

  const handleEdit = reminder => {
    setSelectedReminder(reminder);
    setIsDrawerOpen(true);
  };

  const handleAddNew = () => {
    setSelectedReminder(null);
    setIsDrawerOpen(true);
  };

  const handleSaveComplete = () => {
    setIsDrawerOpen(false);
    setSelectedReminder(null);
    setRefreshKey(prev => prev + 1);
  };

  return (
    <div className="p-4 relative">
      {/* Header */}
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-2xl font-semibold">Reminders</h2>
        <button
          onClick={handleAddNew}
          className="bg-purple-600 text-white px-4 py-2 rounded-lg"
        >
          ‚ûï Add Reminder
        </button>
      </div>

      {/* Reminder Cards */}
      <ReminderList onEdit={handleEdit} refreshKey={refreshKey} />

      {/* Drawer */}
      {isDrawerOpen && (
        <div className="fixed top-0 right-0 w-full max-w-md h-full bg-white shadow-2xl z-50 transition-transform duration-300 border-l overflow-y-auto">
          <div className="flex items-center justify-between p-4 border-b">
            <h2 className="text-lg font-bold">
              {selectedReminder ? "Edit Reminder" : "Add Reminder"}
            </h2>
            <button
              onClick={() => setIsDrawerOpen(false)}
              className="text-gray-500 text-xl"
            >
              √ó
            </button>
          </div>
          <div className="p-4">
            <ReminderForm
              selectedReminder={selectedReminder}
              onSaveComplete={handleSaveComplete}
            />
          </div>
        </div>
      )}
    </div>
  );
}

export default Reminders;

// import React, { useState } from "react";
// import ReminderForm from "./ReminderForm";
// import ReminderList from "./ReminderList";

// function Reminders() {
//   const [selectedReminder, setSelectedReminder] = useState(null);
//   const [refreshKey, setRefreshKey] = useState(0); // used to refresh list

//   const handleEdit = reminder => {
//     setSelectedReminder(reminder);
//   };

//   const handleSaveComplete = () => {
//     setSelectedReminder(null);
//     setRefreshKey(prev => prev + 1);
//   };

//   return (
//     <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
//       {/* Left: Form */}
//       <div className="bg-white rounded-2xl shadow-md p-4">
//         <h2 className="text-xl font-semibold mb-2">
//           {selectedReminder ? "Edit Reminder" : "Add Reminder"}
//         </h2>
//         <ReminderForm
//           selectedReminder={selectedReminder}
//           onSaveComplete={handleSaveComplete}
//         />
//       </div>

//       {/* Right: List */}
//       <div className="bg-white rounded-2xl shadow-md p-4">
//         <h2 className="text-xl font-semibold mb-2">Reminder List</h2>
//         <ReminderList onEdit={handleEdit} refreshKey={refreshKey} />
//       </div>
//     </div>
//   );
// }

// export default Reminders;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Reminders\MakeDump.bat 
====================================================== 
 
@echo off
REM This script will find relevant source files and output their names and contents into one file.
REM The output file will be named [FolderName]_AllFileDump.txt.

REM Get the current folder's name and set it as the output file name with the custom suffix
for %%I in ("%cd%") do set "outputFile=%%~nI_AllFileDump.txt"

REM Clear the output file to start fresh and write a small header
> "%outputFile%" (
    echo Folder and File Content Report
    echo Root folder: %cd%
    echo Generated at: %date% %time%
)
echo. >> "%outputFile%"

REM NOTE:
REM We now only dump RELEVANT text/code files (no binaries, no images, no node_modules, etc.)
REM This keeps the file smaller and much easier to review.

REM Loop through all relevant files in the current directory and subdirectories
REM Extensions included: C#, JS/TS/React, JSON, config, SQL, Markdown, YAML
for /R . %%F in (*.cs *.csproj *.jsx *.tsx *.js *.ts *.json *.config *.sql *.md *.yml *.yaml *.bat) do (

    REM Skip some noisy folders by path substring (node_modules, bin, obj, .git, dist, .vs)
    echo "%%F" | findstr /I /C:"\node_modules\" /C:"\bin\" /C:"\obj\" /C:"\.git\" /C:"\dist\" /C:"\.vs\" >nul
    if errorlevel 1 (
        echo ====================================================== >> "%outputFile%"
        echo FILE: %%F >> "%outputFile%"
        echo ====================================================== >> "%outputFile%"
        echo. >> "%outputFile%"
        type "%%F" >> "%outputFile%" 2>nul
        echo. >> "%outputFile%"
        echo. >> "%outputFile%"
    )
)

echo Finished! All content has been extracted to %outputFile%
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Tags\TagForm.jsx 
====================================================== 
 
import { useState, useEffect } from "react";
import { Tag, PlusCircle } from "lucide-react";
import { toast } from "react-toastify";

export default function TagForm({ selectedTag, onSaveComplete }) {
  const [tag, setTag] = useState({
    name: "",
    colorHex: "",
    category: "",
    notes: "",
    isSystemTag: false,
    isActive: true,
  });

  useEffect(() => {
    if (selectedTag) {
      setTag(selectedTag);
    }
  }, [selectedTag]);

  const handleChange = e => {
    const { name, value, type, checked } = e.target;
    setTag(prev => ({
      ...prev,
      [name]: type === "checkbox" ? checked : value,
    }));
  };

  const handleSubmit = async e => {
    e.preventDefault();

    if (!tag.name.trim()) return;

    try {
      const method = selectedTag ? "PUT" : "POST";
      const url = selectedTag ? `/api/tags/${selectedTag.id}` : "/api/tags";

      const res = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(tag),
      });

      if (!res.ok) throw new Error("Failed to save tag");

      toast.success(
        `‚úÖ Tag ${selectedTag ? "updated" : "added"} successfully!`
      );
      onSaveComplete();
    } catch (err) {
      console.error("‚ùå Failed to save tag:", err);
      toast.error("‚ùå Failed to save tag");
    }
  };

  const isFormValid = tag.name.trim().length > 0;

  return (
    <div className="bg-white rounded-md border shadow-sm p-6 w-full transition hover:shadow-md">
      {/* üè∑Ô∏è Form Header */}
      <div className="flex items-center gap-3 mb-5">
        <div className="bg-purple-100 text-purple-700 rounded-xl p-2">
          <Tag size={22} />
        </div>
        <div>
          <h2 className="text-lg font-bold text-gray-800">
            {selectedTag ? "Edit Tag" : "Add New Tag"}
          </h2>
          <p className="text-sm text-gray-600">
            Create custom tags with color, category, and notes.
          </p>
        </div>
      </div>

      {/* üìù Form Fields */}
      <form onSubmit={handleSubmit} className="space-y-5">
        <div>
          <label className="text-xs font-medium text-gray-600 mb-1 block">
            Tag Name <span className="text-red-500">*</span>
          </label>
          <input
            type="text"
            name="name"
            value={tag.name}
            onChange={handleChange}
            placeholder="e.g. High Priority"
            className="w-full px-4 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
          />
        </div>

        <div>
          <label className="text-xs font-medium text-gray-600 mb-1 block">
            Tag Color (Hex)
          </label>
          <input
            type="text"
            name="colorHex"
            value={tag.colorHex}
            onChange={handleChange}
            placeholder="#FF5733"
            className="w-full px-4 py-2 border rounded-md text-sm"
          />
        </div>

        <div>
          <label className="text-xs font-medium text-gray-600 mb-1 block">
            Category
          </label>
          <input
            type="text"
            name="category"
            value={tag.category}
            onChange={handleChange}
            placeholder="e.g. Priority"
            className="w-full px-4 py-2 border rounded-md text-sm"
          />
        </div>

        <div>
          <label className="text-xs font-medium text-gray-600 mb-1 block">
            Notes
          </label>
          <textarea
            name="notes"
            value={tag.notes}
            onChange={handleChange}
            placeholder="Optional description..."
            rows={3}
            className="w-full px-4 py-2 border rounded-md text-sm resize-none"
          />
        </div>

        <div className="flex items-center gap-6 mt-1">
          <label className="flex items-center text-sm gap-2">
            <input
              type="checkbox"
              name="isSystemTag"
              checked={tag.isSystemTag}
              onChange={handleChange}
            />
            System Tag
          </label>

          <label className="flex items-center text-sm gap-2">
            <input
              type="checkbox"
              name="isActive"
              checked={tag.isActive}
              onChange={handleChange}
            />
            Active
          </label>
        </div>

        {/* Submit Button */}
        <div className="pt-4 border-t flex justify-end">
          <button
            type="submit"
            disabled={!isFormValid}
            className={`inline-flex items-center gap-2 px-5 py-2 rounded-md text-white text-sm font-medium transition ${
              isFormValid
                ? "bg-purple-600 hover:bg-purple-700"
                : "bg-gray-300 cursor-not-allowed"
            }`}
          >
            <PlusCircle size={18} />
            {selectedTag ? "Update Tag" : "Add Tag"}
          </button>
        </div>
      </form>
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Tags\TagList.jsx 
====================================================== 
 
import { useEffect, useState } from "react";
import { Trash2, Pencil } from "lucide-react";
import { toast } from "react-toastify";

export default function TagList({ onEditTag, refreshTrigger }) {
  const [tags, setTags] = useState([]);
  const [loading, setLoading] = useState(false);

  const fetchTags = async () => {
    setLoading(true);
    try {
      const res = await fetch("/api/tags");
      const result = await res.json();

      // ‚úÖ Extract actual array from result.data
      if (Array.isArray(result.data)) {
        setTags(result.data);
      } else {
        setTags([]);
        console.error(
          "Invalid response from /api/tags. Expected result.data to be array:",
          result
        );
        toast.error("‚ùå Invalid tag data received");
      }
    } catch (err) {
      console.error("Failed to fetch tags", err);
      toast.error("‚ùå Failed to load tags");
      setTags([]);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchTags();
  }, [refreshTrigger]);

  const handleDelete = async id => {
    if (!window.confirm("Are you sure you want to delete this tag?")) return;

    try {
      const res = await fetch(`/api/tags/${id}`, {
        method: "DELETE",
      });

      if (!res.ok) throw new Error();

      toast.success("‚úÖ Tag deleted");
      fetchTags();
    } catch (err) {
      toast.error("‚ùå Failed to delete tag");
    }
  };

  return (
    <div className="mt-6 bg-white rounded-md border shadow-sm p-6 transition hover:shadow-md">
      <h2 className="text-lg font-bold text-gray-800 mb-3">üóÇÔ∏è All Tags</h2>

      {loading ? (
        <p className="text-sm text-gray-500">Loading tags...</p>
      ) : tags.length === 0 ? (
        <p className="text-sm text-gray-500">No tags found.</p>
      ) : (
        <div className="space-y-3">
          {tags.map(tag => (
            <div
              key={tag.id}
              className="flex items-center justify-between border-b pb-2"
            >
              <div className="flex items-center gap-3">
                <div
                  className="w-4 h-4 rounded-full border"
                  style={{ backgroundColor: tag.colorHex || "#ccc" }}
                ></div>
                <div>
                  <p className="text-sm font-medium text-gray-800">
                    {tag.name}
                  </p>
                  <p className="text-xs text-gray-500">
                    {tag.category || "Uncategorized"}{" "}
                    {tag.isSystemTag && "¬∑ System"}
                  </p>
                </div>
              </div>

              <div className="flex items-center gap-3">
                <button
                  onClick={() => onEditTag(tag)}
                  className="text-gray-600 hover:text-purple-600"
                  title="Edit"
                >
                  <Pencil size={18} />
                </button>
                <button
                  onClick={() => handleDelete(tag.id)}
                  className="text-gray-600 hover:text-red-600"
                  title="Delete"
                >
                  <Trash2 size={18} />
                </button>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Tags\Tags.jsx 
====================================================== 
 
// üìÑ File: src/pages/Tags/Tags.jsx
import React, { useState } from "react";
import { Tag } from "lucide-react";
import TagForm from "./TagForm";
import TagList from "./TagList";
import { toast } from "react-toastify";

export default function Tags() {
  const [selectedTag, setSelectedTag] = useState(null);
  const [refreshKey, setRefreshKey] = useState(0);

  const handleEdit = tag => {
    setSelectedTag(tag);
  };

  const handleSaveComplete = (success = true, message = "") => {
    setSelectedTag(null);
    setRefreshKey(prev => prev + 1);

    if (success) {
      toast.success(message || "‚úÖ Tag saved successfully");
    } else {
      toast.error(message || "‚ùå Failed to save tag");
    }
  };

  const handleDeleteComplete = (success = true, message = "") => {
    setRefreshKey(prev => prev + 1);

    if (success) {
      toast.success(message || "üóëÔ∏è Tag deleted successfully");
    } else {
      toast.error(message || "‚ùå Failed to delete tag");
    }
  };

  return (
    <div className="p-6 space-y-8">
      {/* üü£ Smart Banner */}
      <div className="bg-gradient-to-br from-purple-50 to-white border border-purple-200 rounded-md shadow-sm p-5 flex items-start gap-4">
        <div className="bg-purple-100 text-purple-700 rounded-md p-2 shadow-sm">
          <Tag size={24} />
        </div>
        <div className="flex-1">
          <h2 className="text-lg font-bold text-purple-800 mb-1">
            Organise Smartly with Tags
          </h2>
          <p className="text-sm text-gray-700 leading-relaxed">
            Tags help you <strong>segment, prioritise</strong>, and manage your
            contacts effectively. Add labels like{" "}
            <span className="text-purple-700 font-medium">"Leads"</span>,{" "}
            <span className="text-purple-700 font-medium">"Follow Up"</span>, or{" "}
            <span className="text-purple-700 font-medium">"VIP"</span> to group
            and target the right audience. It‚Äôs the fastest way to personalise
            campaigns and automate your CRM flow.
          </p>
        </div>
      </div>

      {/* üß± Form + Tag List */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* ‚ûï Add/Edit Tag Form */}
        <TagForm
          selectedTag={selectedTag}
          onSaveComplete={handleSaveComplete}
        />

        {/* üè∑Ô∏è Tag List */}
        <div className="space-y-3">
          <h2 className="text-md font-semibold text-gray-700 px-1">
            üè∑Ô∏è Tag List
          </h2>
          <TagList
            onEdit={handleEdit}
            refreshKey={refreshKey}
            onDeleteComplete={handleDeleteComplete}
          />
        </div>
      </div>
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Tags\TagSelector.jsx 
====================================================== 
 
import React, { useEffect, useState } from "react";
import axios from "axios";

/**
 * TagSelector - A dropdown/select box to choose one or more tags.
 * Props:
 * - selected: array of selected tag IDs
 * - onChange: callback with updated tag array
 * - multi: boolean (allow multi-select or not)
 */
export default function TagSelector({ selected = [], onChange, multi = true }) {
  const [tags, setTags] = useState([]);

  useEffect(() => {
    fetchTags();
  }, []);

  const fetchTags = async () => {
    try {
      const res = await axios.get("/api/tags");
      setTags(Array.isArray(res.data) ? res.data : []);
    } catch (err) {
      console.error("‚ùå Failed to load tags", err);
      setTags([]); // fallback to empty
    }
  };

  const handleToggle = tagId => {
    if (multi) {
      const isSelected = selected.includes(tagId);
      const updated = isSelected
        ? selected.filter(id => id !== tagId)
        : [...selected, tagId];
      onChange(updated);
    } else {
      onChange([tagId]);
    }
  };

  return (
    <div className="flex flex-wrap gap-2">
      {(Array.isArray(tags) ? tags : []).map(tag => {
        const isSelected = selected.includes(tag.id);
        return (
          <button
            key={tag.id}
            onClick={() => handleToggle(tag.id)}
            className={`px-3 py-1 rounded-full text-sm border transition-all duration-150 ${
              isSelected
                ? "bg-purple-600 text-white border-purple-600"
                : "bg-gray-100 text-gray-700 border-gray-300"
            }`}
            title={tag.notes || tag.name}
          >
            <span
              className="inline-block w-2 h-2 rounded-full mr-2"
              style={{ backgroundColor: tag.colorHex || "#999" }}
            ></span>
            {tag.name}
          </button>
        );
      })}
    </div>
  );
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Tags\MakeDump.bat 
====================================================== 
 
@echo off
REM This script will find relevant source files and output their names and contents into one file.
REM The output file will be named [FolderName]_AllFileDump.txt.

REM Get the current folder's name and set it as the output file name with the custom suffix
for %%I in ("%cd%") do set "outputFile=%%~nI_AllFileDump.txt"

REM Clear the output file to start fresh and write a small header
> "%outputFile%" (
    echo Folder and File Content Report
    echo Root folder: %cd%
    echo Generated at: %date% %time%
)
echo. >> "%outputFile%"

REM NOTE:
REM We now only dump RELEVANT text/code files (no binaries, no images, no node_modules, etc.)
REM This keeps the file smaller and much easier to review.

REM Loop through all relevant files in the current directory and subdirectories
REM Extensions included: C#, JS/TS/React, JSON, config, SQL, Markdown, YAML
for /R . %%F in (*.cs *.csproj *.jsx *.tsx *.js *.ts *.json *.config *.sql *.md *.yml *.yaml *.bat) do (

    REM Skip some noisy folders by path substring (node_modules, bin, obj, .git, dist, .vs)
    echo "%%F" | findstr /I /C:"\node_modules\" /C:"\bin\" /C:"\obj\" /C:"\.git\" /C:"\dist\" /C:"\.vs\" >nul
    if errorlevel 1 (
        echo ====================================================== >> "%outputFile%"
        echo FILE: %%F >> "%outputFile%"
        echo ====================================================== >> "%outputFile%"
        echo. >> "%outputFile%"
        type "%%F" >> "%outputFile%" 2>nul
        echo. >> "%outputFile%"
        echo. >> "%outputFile%"
    )
)

echo Finished! All content has been extracted to %outputFile%
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Timeline\EmptyTimelineState.jsx 
====================================================== 
 
import React from "react";

function EmptyTimelineState() {
  return (
    <div className="text-center text-gray-500 p-10">
      <div className="text-5xl mb-3">üßπ</div>
      <h3 className="text-xl font-bold mb-2">No Timeline Yet</h3>
      <p className="text-sm">Activities will appear here once you interact!</p>
    </div>
  );
}

export default EmptyTimelineState;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Timeline\LeadTimeline.jsx 
====================================================== 
 
import React, { useState, useEffect, useCallback } from "react";
import axiosClient from "../../../api/axiosClient";
import TimelineEventCard from "./TimelineEventCard";
import { useParams } from "react-router-dom";
import { toast } from "react-toastify";

function LeadTimeline() {
  const { contactId } = useParams();
  const [timeline, setTimeline] = useState([]);
  const [loading, setLoading] = useState(true);
  const [contact, setContact] = useState(null);

  // ‚úÖ Fetch Contact Info (wrapped in useCallback)
  const fetchContactInfo = useCallback(async () => {
    try {
      const res = await axiosClient.get(`/contacts/${contactId}`);
      setContact(res.data);
    } catch (error) {
      console.error("Failed to fetch contact info", error);
      toast.error("‚ùå Failed to load contact info");
    }
  }, [contactId]);

  // ‚úÖ Fetch Timeline Events (wrapped in useCallback)
  const fetchTimeline = useCallback(async () => {
    try {
      setLoading(true);
      const res = await axiosClient.get(`/leadtimeline/contact/${contactId}`);
      setTimeline(res.data || []);
    } catch (error) {
      console.error("Failed to fetch timeline", error);
      toast.error("‚ùå Failed to load timeline events");
    } finally {
      setLoading(false);
    }
  }, [contactId]);

  useEffect(() => {
    if (contactId) {
      fetchContactInfo();
      fetchTimeline();
    }
  }, [contactId, fetchContactInfo, fetchTimeline]);

  return (
    <div className="p-6 max-w-5xl mx-auto">
      {/* Top Bar */}
      <div className="flex items-center justify-between mb-6">
        <div>
          <h2 className="text-2xl font-bold text-gray-800">üïì Lead Timeline</h2>
          {contact && (
            <p className="text-gray-600 text-sm mt-1">
              <span className="font-semibold">{contact.name || "Unknown"}</span>{" "}
              ‚Ä¢ {contact.phoneNumber}
            </p>
          )}
        </div>
        <button
          onClick={() => fetchTimeline()}
          className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow text-sm"
        >
          üîÑ Refresh
        </button>
      </div>

      {/* Timeline Section */}
      <div className="relative pl-10 border-l-2 border-gray-200 space-y-8">
        {loading ? (
          <p className="text-gray-500">‚è≥ Loading timeline...</p>
        ) : timeline.length === 0 ? (
          <p className="text-gray-400 italic">
            No timeline activities found for this contact.
          </p>
        ) : (
          timeline.map(entry => (
            <TimelineEventCard key={entry.id} entry={entry} />
          ))
        )}
      </div>
    </div>
  );
}

export default LeadTimeline;

// import React, { useState, useEffect } from "react";
// import axiosClient from "../../api/axiosClient";
// import TimelineEventCard from "./TimelineEventCard";
// import { useParams } from "react-router-dom";
// import { toast } from "react-toastify";

// function LeadTimeline() {
//   const { contactId } = useParams();
//   const [timeline, setTimeline] = useState([]);
//   const [loading, setLoading] = useState(true);
//   const [contact, setContact] = useState(null);

//   // ‚úÖ Fetch Contact Info
//   const fetchContactInfo = async () => {
//     try {
//       const res = await axiosClient.get(`/contacts/${contactId}`);
//       setContact(res.data);
//     } catch (error) {
//       console.error("Failed to fetch contact info", error);
//       toast.error("‚ùå Failed to load contact info");
//     }
//   };

//   // ‚úÖ Fetch Timeline Events
//   const fetchTimeline = async () => {
//     try {
//       setLoading(true);
//       const res = await axiosClient.get(`/leadtimeline/contact/${contactId}`);
//       setTimeline(res.data || []);
//     } catch (error) {
//       console.error("Failed to fetch timeline", error);
//       toast.error("‚ùå Failed to load timeline events");
//     } finally {
//       setLoading(false);
//     }
//   };

//   useEffect(() => {
//     if (contactId) {
//       fetchContactInfo();
//       fetchTimeline();
//     }
//   }, [contactId]);

//   return (
//     <div className="p-6 max-w-5xl mx-auto">
//       {/* Top Bar */}
//       <div className="flex items-center justify-between mb-6">
//         <div>
//           <h2 className="text-2xl font-bold text-gray-800">üïì Lead Timeline</h2>
//           {contact && (
//             <p className="text-gray-600 text-sm mt-1">
//               <span className="font-semibold">{contact.name || "Unknown"}</span>{" "}
//               ‚Ä¢ {contact.phoneNumber}
//             </p>
//           )}
//         </div>
//         <button
//           onClick={() => fetchTimeline()}
//           className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow text-sm"
//         >
//           üîÑ Refresh
//         </button>
//       </div>

//       {/* Timeline Section */}
//       <div className="relative pl-10 border-l-2 border-gray-200 space-y-8">
//         {loading ? (
//           <p className="text-gray-500">‚è≥ Loading timeline...</p>
//         ) : timeline.length === 0 ? (
//           <p className="text-gray-400 italic">
//             No timeline activities found for this contact.
//           </p>
//         ) : (
//           timeline.map(entry => (
//             <TimelineEventCard key={entry.id} entry={entry} />
//           ))
//         )}
//       </div>
//     </div>
//   );
// }

// export default LeadTimeline;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Timeline\LeadTimeline_old.jsx 
====================================================== 
 
import React, { useState, useEffect, useCallback } from "react";
import { useParams } from "react-router-dom";
import axiosClient from "../../api/axiosClient";
import TimelineEntryCard from "../../components/TimelineEntryCard";
import { toast } from "react-toastify";

const LeadTimeline = () => {
  const { contactId } = useParams();
  const [timeline, setTimeline] = useState([]);
  const [loading, setLoading] = useState(true);
  const [contacts, setContacts] = useState([]);
  const [selectedContactId, setSelectedContactId] = useState("");
  const [selectedEventType, setSelectedEventType] = useState("");
  const [eventType, setEventType] = useState("");
  const [description, setDescription] = useState("");
  const [pageSize, setPageSize] = useState(10);
  const [currentPage, setCurrentPage] = useState(1);

  // 1. Wrap in useCallback!
  const fetchTimeline = useCallback(async () => {
    try {
      setLoading(true);
      const url = contactId
        ? `/leadtimeline/contact/${contactId}`
        : `/leadtimeline`;
      const response = await axiosClient.get(url);
      setTimeline(response.data);
    } catch (error) {
      // handled globally
    } finally {
      setLoading(false);
    }
  }, [contactId]);

  const fetchContacts = useCallback(async () => {
    try {
      const res = await axiosClient.get("/contacts");
      setContacts(res.data || []);
    } catch (err) {
      toast.error("‚ùå Failed to load contacts for filtering");
    }
  }, []);

  const handleAddTimeline = async () => {
    if (!eventType || !description) {
      toast.warn("Please fill in both fields.");
      return;
    }
    try {
      await axiosClient.post("/leadtimeline", {
        contactId,
        eventType,
        description,
        createdBy: "You",
        source: "UI",
        category: "Manual",
        isSystemGenerated: false,
      });
      toast.success("‚úÖ Timeline entry added");
      setEventType("");
      setDescription("");
      fetchTimeline();
    } catch (err) {
      console.error("Failed to add entry:", err);
    }
  };

  // 2. Add fetchTimeline & fetchContacts to dependencies!
  useEffect(() => {
    fetchTimeline();
    fetchContacts();
  }, [fetchTimeline, fetchContacts]);

  // ... (rest is unchanged)
  const filteredTimeline = timeline.filter(entry => {
    const contactMatch = selectedContactId
      ? entry.contactId === selectedContactId
      : true;
    const typeMatch = selectedEventType
      ? entry.eventType === selectedEventType
      : true;
    return contactMatch && typeMatch;
  });

  const totalPages = Math.ceil(filteredTimeline.length / pageSize);
  const startIndex = (currentPage - 1) * pageSize;
  const paginatedTimeline = filteredTimeline.slice(
    startIndex,
    startIndex + pageSize
  );

  const handlePageChange = direction => {
    if (direction === "prev" && currentPage > 1) {
      setCurrentPage(currentPage - 1);
    } else if (direction === "next" && currentPage < totalPages) {
      setCurrentPage(currentPage + 1);
    }
  };

  const handlePageSizeChange = e => {
    setPageSize(Number(e.target.value));
    setCurrentPage(1); // reset to page 1
  };

  return (
    <div className="p-4 bg-gray-50 min-h-screen">
      <h1 className="text-2xl font-bold mb-4">Lead Timeline</h1>
      {/* ... (rest unchanged) */}
      {/* üîç Filter Bar */}
      <div className="bg-white rounded shadow p-4 mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
        <select
          value={selectedContactId}
          onChange={e => setSelectedContactId(e.target.value)}
          className="border rounded px-3 py-2"
        >
          <option value="">All Contacts</option>
          {contacts.map(contact => (
            <option key={contact.id} value={contact.id}>
              {contact.name} ({contact.phoneNumber})
            </option>
          ))}
        </select>
        <select
          value={selectedEventType}
          onChange={e => setSelectedEventType(e.target.value)}
          className="border rounded px-3 py-2"
        >
          <option value="">All Event Types</option>
          <option value="PhoneCall">üìû Phone Call</option>
          <option value="ReminderSet">‚è∞ Reminder Set</option>
          <option value="NoteAdded">üìù Note Added</option>
          <option value="CustomActivity">‚öôÔ∏è Custom Activity</option>
        </select>
        <button
          onClick={() => {
            setSelectedContactId("");
            setSelectedEventType("");
          }}
          className="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300"
        >
          Reset Filters
        </button>
      </div>

      {/* ‚ûï Add Entry Form */}
      <div className="bg-white rounded shadow p-4 mb-6">
        <h3 className="text-lg font-semibold mb-2">Add Timeline Entry</h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input
            type="text"
            placeholder="Event Type (e.g., Phone Call)"
            value={eventType}
            onChange={e => setEventType(e.target.value)}
            className="border rounded px-3 py-2"
          />
          <input
            type="text"
            placeholder="Description"
            value={description}
            onChange={e => setDescription(e.target.value)}
            className="border rounded px-3 py-2"
          />
          <button
            onClick={handleAddTimeline}
            className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
          >
            ‚ûï Add Entry
          </button>
        </div>
      </div>

      {/* üî¢ Pagination Controls */}
      <div className="flex justify-between items-center mb-3">
        <div>
          <label className="text-sm text-gray-600 mr-2">Show:</label>
          <select
            value={pageSize}
            onChange={handlePageSizeChange}
            className="border rounded px-2 py-1 text-sm"
          >
            <option value={10}>10</option>
            <option value={25}>25</option>
            <option value={50}>50</option>
          </select>
          <span className="ml-2 text-sm text-gray-600">entries per page</span>
        </div>
        <div className="space-x-2">
          <button
            onClick={() => handlePageChange("prev")}
            className="text-sm px-3 py-1 border rounded bg-gray-200 hover:bg-gray-300"
            disabled={currentPage === 1}
          >
            ‚¨Ö Prev
          </button>
          <span className="text-sm text-gray-700">
            Page {currentPage} of {totalPages}
          </span>
          <button
            onClick={() => handlePageChange("next")}
            className="text-sm px-3 py-1 border rounded bg-gray-200 hover:bg-gray-300"
            disabled={currentPage === totalPages}
          >
            Next ‚û°
          </button>
        </div>
      </div>

      {/* Timeline List */}
      {loading ? (
        <p>Loading...</p>
      ) : paginatedTimeline.length > 0 ? (
        paginatedTimeline.map(entry => (
          <TimelineEntryCard key={entry.id} entry={entry} />
        ))
      ) : (
        <p className="text-gray-500">No timeline entries match your filters.</p>
      )}
    </div>
  );
};

export default LeadTimeline;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Timeline\TimelineEventCard.jsx 
====================================================== 
 
import React from "react";
import { formatAgo } from "./timelineUtils"; // ‚úÖ Correct import

function TimelineEventCard({ entry }) {
  // üîµ Pick Icon based on eventType
  const getIcon = () => {
    if (entry.eventType === "CatalogCTA") return "üõçÔ∏è";
    if (entry.eventType === "CampaignSend") return "‚úâÔ∏è"; // ‚úÖ New: Campaign Send icon
    if (entry.eventType === "ReminderSet") return "‚è∞";
    if (entry.eventType === "NoteAdded") return "üìù";
    if (entry.eventType === "CustomActivity") return "‚öôÔ∏è";
    return "üìå"; // default for unknown event types
  };

  // üè∑Ô∏è Pick badge color
  const getBadgeStyle = () => {
    if (entry.eventType === "CatalogCTA") return "bg-green-100 text-green-800";
    if (entry.eventType === "CampaignSend")
      return "bg-indigo-100 text-indigo-800"; // ‚úÖ New: Campaign Send badge
    if (entry.eventType === "ReminderSet")
      return "bg-yellow-100 text-yellow-800";
    if (entry.eventType === "NoteAdded") return "bg-blue-100 text-blue-800";
    if (entry.eventType === "CustomActivity")
      return "bg-purple-100 text-purple-800";
    return "bg-gray-100 text-gray-800"; // default style
  };

  return (
    <div className="relative">
      {/* üîµ Dot */}
      <div className="absolute -left-7 top-5 w-4 h-4 bg-purple-600 rounded-full border-2 border-white shadow"></div>

      {/* üß© Event Card */}
      <div className="bg-white rounded-xl shadow-md p-4">
        <div className="flex justify-between items-center mb-2">
          {/* üß† Icon + Event Type */}
          <div className="flex items-center gap-2 text-purple-700 font-semibold">
            <span className="text-xl">{getIcon()}</span>
            <span>{entry.eventType}</span>
          </div>

          {/* üè∑Ô∏è Badge */}
          <div
            className={`text-xs font-bold px-2 py-1 rounded ${getBadgeStyle()}`}
          >
            {entry.eventType}
          </div>
        </div>

        {/* üìù Description */}
        <div className="text-gray-700 text-sm mb-2">
          {entry.description || "(No description provided)"}
        </div>

        {/* üïë Timestamp */}
        <div className="text-xs text-gray-400">
          {formatAgo(entry.createdAt)}
        </div>
      </div>
    </div>
  );
}

export default TimelineEventCard;
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Timeline\timelineUtils.js 
====================================================== 
 
// üìÖ Utility functions for Timeline

export function formatAgo(dateString) {
  const date = new Date(dateString);
  const now = new Date();

  const diffMs = now - date;
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

  if (diffDays === 0) {
    return `Today at ${date.toLocaleTimeString([], {
      hour: "2-digit",
      minute: "2-digit",
    })}`;
  } else if (diffDays === 1) {
    return `Yesterday at ${date.toLocaleTimeString([], {
      hour: "2-digit",
      minute: "2-digit",
    })}`;
  } else if (diffDays < 7) {
    return `${diffDays} days ago`;
  } else {
    return date.toLocaleDateString();
  }
}
 
 
====================================================== 
FILE: D:\xbytechat\xbytechat-ui\src\pages\CRM\Timeline\Services\LeadTimelineService.cs 
====================================================== 
 
Task AddEventAsync(
    Guid businessId,
    Guid contactId,
    string eventType,
    string description,
    string? source = null,
    string? category = null,
    Guid? referenceId = null,
    bool isSystemGenerated = true,
    string? ctaType = null,
    string? ctaSourceType = null,
    Guid? ctaSourceId = null,
    CancellationToken ct = default);
 
 
